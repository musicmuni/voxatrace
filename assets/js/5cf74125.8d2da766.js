"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[9800],{1175(e,r,n){n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"guides/recording-audio","title":"Recording Audio","description":"A complete guide to capturing audio with SonixRecorder.","source":"@site/docs/guides/recording-audio.md","sourceDirName":"guides","slug":"/guides/recording-audio","permalink":"/voxatrace/guides/recording-audio","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Playing Audio","permalink":"/voxatrace/guides/playing-audio"},"next":{"title":"Detecting Pitch","permalink":"/voxatrace/guides/detecting-pitch"}}');var o=n(4848),t=n(8453);const a={sidebar_position:2},l="Recording Audio",c={},d=[{value:"What You&#39;ll Learn",id:"what-youll-learn",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Kotlin",id:"kotlin",level:3},{value:"Swift",id:"swift",level:3},{value:"Permissions",id:"permissions",level:2},{value:"Android",id:"android",level:3},{value:"iOS",id:"ios",level:3},{value:"Output Formats",id:"output-formats",level:2},{value:"M4A (Default)",id:"m4a-default",level:3},{value:"MP3",id:"mp3",level:3},{value:"WAV",id:"wav",level:3},{value:"Format Detection",id:"format-detection",level:3},{value:"Quality Presets",id:"quality-presets",level:2},{value:"Voice (Default)",id:"voice-default",level:3},{value:"Standard",id:"standard",level:3},{value:"High",id:"high",level:3},{value:"Custom Quality",id:"custom-quality",level:3},{value:"Monitoring Levels",id:"monitoring-levels",level:2},{value:"Observing State",id:"observing-state",level:2},{value:"StateFlow",id:"stateflow",level:3},{value:"Callbacks",id:"callbacks",level:3},{value:"Real-time Audio Access",id:"real-time-audio-access",level:2},{value:"Echo Cancellation",id:"echo-cancellation",level:2},{value:"Playback Synchronization",id:"playback-synchronization",level:2},{value:"Segment Recording",id:"segment-recording",level:2},{value:"Temporary Recording",id:"temporary-recording",level:2},{value:"Sample Rate Handling",id:"sample-rate-handling",level:2},{value:"Platform Considerations",id:"platform-considerations",level:2},{value:"iOS",id:"ios-1",level:3},{value:"Android",id:"android-1",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Voice Memo Recorder",id:"voice-memo-recorder",level:3},{value:"Recording with Pitch Detection",id:"recording-with-pitch-detection",level:3},{value:"Next Steps",id:"next-steps",level:2}];function s(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.header,{children:(0,o.jsx)(r.h1,{id:"recording-audio",children:"Recording Audio"})}),"\n",(0,o.jsx)(r.p,{children:"A complete guide to capturing audio with SonixRecorder."}),"\n",(0,o.jsx)(r.h2,{id:"what-youll-learn",children:"What You'll Learn"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"Record from the microphone"}),"\n",(0,o.jsx)(r.li,{children:"Choose formats and quality presets"}),"\n",(0,o.jsx)(r.li,{children:"Monitor recording levels"}),"\n",(0,o.jsx)(r.li,{children:"Access raw audio for real-time processing"}),"\n",(0,o.jsx)(r.li,{children:"Handle segment recording for practice apps"}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"VoxaTrace installed"}),"\n",(0,o.jsx)(r.li,{children:"Microphone permission configured"}),"\n",(0,o.jsx)(r.li,{children:"Output path accessible for writing"}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,o.jsx)(r.h3,{id:"kotlin",children:"Kotlin"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:'val recorder = SonixRecorder.create("/path/to/output.m4a")\r\nrecorder.start()\r\n\r\n// Record for a while...\r\n\r\nrecorder.stop()\r\nrecorder.release()\n'})}),"\n",(0,o.jsx)(r.h3,{id:"swift",children:"Swift"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-swift",children:'let recorder = SonixRecorder.create(outputPath: "/path/to/output.m4a")\r\nrecorder.start()\r\n\r\n// Record for a while...\r\n\r\nrecorder.stop()\r\nrecorder.release()\n'})}),"\n",(0,o.jsx)(r.h2,{id:"permissions",children:"Permissions"}),"\n",(0,o.jsx)(r.h3,{id:"android",children:"Android"}),"\n",(0,o.jsxs)(r.p,{children:["Add to ",(0,o.jsx)(r.code,{children:"AndroidManifest.xml"}),":"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-xml",children:'<uses-permission android:name="android.permission.RECORD_AUDIO" />\n'})}),"\n",(0,o.jsx)(r.p,{children:"Request at runtime:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:"if (ContextCompat.checkSelfPermission(context, Manifest.permission.RECORD_AUDIO)\r\n    != PackageManager.PERMISSION_GRANTED) {\r\n    ActivityCompat.requestPermissions(\r\n        activity,\r\n        arrayOf(Manifest.permission.RECORD_AUDIO),\r\n        REQUEST_CODE\r\n    )\r\n}\n"})}),"\n",(0,o.jsx)(r.h3,{id:"ios",children:"iOS"}),"\n",(0,o.jsxs)(r.p,{children:["Add to ",(0,o.jsx)(r.code,{children:"Info.plist"}),":"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-xml",children:"<key>NSMicrophoneUsageDescription</key>\r\n<string>We need microphone access to record your voice.</string>\n"})}),"\n",(0,o.jsx)(r.h2,{id:"output-formats",children:"Output Formats"}),"\n",(0,o.jsx)(r.h3,{id:"m4a-default",children:"M4A (Default)"}),"\n",(0,o.jsx)(r.p,{children:"AAC-encoded, good compression, widely compatible."}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:'val recorder = SonixRecorder.create("/path/to/output.m4a")\n'})}),"\n",(0,o.jsx)(r.h3,{id:"mp3",children:"MP3"}),"\n",(0,o.jsx)(r.p,{children:"Universal compatibility, moderate compression."}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:'val config = SonixRecorderConfig.Builder()\r\n    .format(AudioFormat.MP3)\r\n    .build()\r\nval recorder = SonixRecorder.create("/path/to/output.mp3", config)\n'})}),"\n",(0,o.jsx)(r.h3,{id:"wav",children:"WAV"}),"\n",(0,o.jsx)(r.p,{children:"Uncompressed, large files, lossless quality."}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:'val config = SonixRecorderConfig.Builder()\r\n    .format(AudioFormat.WAV)\r\n    .build()\r\nval recorder = SonixRecorder.create("/path/to/output.wav", config)\n'})}),"\n",(0,o.jsx)(r.h3,{id:"format-detection",children:"Format Detection"}),"\n",(0,o.jsx)(r.p,{children:"File extension is auto-detected:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:'// Extension determines format\r\nSonixRecorder.create("/path/to/output.m4a")  // M4A\r\nSonixRecorder.create("/path/to/output.mp3")  // MP3\r\nSonixRecorder.create("/path/to/output.wav")  // WAV\n'})}),"\n",(0,o.jsx)(r.h2,{id:"quality-presets",children:"Quality Presets"}),"\n",(0,o.jsx)(r.h3,{id:"voice-default",children:"Voice (Default)"}),"\n",(0,o.jsx)(r.p,{children:"16kHz mono, 64kbps - optimized for speech/singing."}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:"val recorder = SonixRecorder.create(path, SonixRecorderConfig.VOICE)\n"})}),"\n",(0,o.jsx)(r.h3,{id:"standard",children:"Standard"}),"\n",(0,o.jsx)(r.p,{children:"44.1kHz stereo, 128kbps - good balance."}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:"val recorder = SonixRecorder.create(path, SonixRecorderConfig.STANDARD)\n"})}),"\n",(0,o.jsx)(r.h3,{id:"high",children:"High"}),"\n",(0,o.jsx)(r.p,{children:"48kHz stereo, 256kbps - maximum fidelity."}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:"val recorder = SonixRecorder.create(path, SonixRecorderConfig.HIGH)\n"})}),"\n",(0,o.jsx)(r.h3,{id:"custom-quality",children:"Custom Quality"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:"val config = SonixRecorderConfig.Builder()\r\n    .sampleRate(48000)\r\n    .channels(2)  // Stereo\r\n    .bitrate(192_000)\r\n    .build()\n"})}),"\n",(0,o.jsx)(r.h2,{id:"monitoring-levels",children:"Monitoring Levels"}),"\n",(0,o.jsx)(r.p,{children:"Display a VU meter during recording:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:"recorder.level.collect { level ->\r\n    // level is 0.0 (silence) to 1.0 (loud)\r\n    vuMeter.value = level\r\n}\n"})}),"\n",(0,o.jsx)(r.p,{children:"Or use callbacks:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:"val config = SonixRecorderConfig.Builder()\r\n    .onLevelUpdate { level ->\r\n        runOnUiThread { vuMeter.value = level }\r\n    }\r\n    .build()\n"})}),"\n",(0,o.jsx)(r.h2,{id:"observing-state",children:"Observing State"}),"\n",(0,o.jsx)(r.h3,{id:"stateflow",children:"StateFlow"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:"// Recording state machine\r\nrecorder.state.collect { state ->\r\n    when (state) {\r\n        is RecordingState.Idle -> showIdleUI()\r\n        is RecordingState.Starting -> showStartingUI()\r\n        is RecordingState.Recording -> updateDuration(state.durationMs)\r\n        is RecordingState.Stopping -> showStoppingUI()\r\n        is RecordingState.Encoding -> showEncodingUI()\r\n        is RecordingState.Finished -> showFinished(state.outputPath)\r\n        is RecordingState.Error -> showError(state.message)\r\n    }\r\n}\r\n\r\n// Recording flag\r\nrecorder.isRecording.collect { recording ->\r\n    recordButton.icon = if (recording) stopIcon else recordIcon\r\n}\r\n\r\n// Duration\r\nrecorder.duration.collect { durationMs ->\r\n    timerLabel.text = formatDuration(durationMs)\r\n}\n"})}),"\n",(0,o.jsx)(r.h3,{id:"callbacks",children:"Callbacks"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:'val config = SonixRecorderConfig.Builder()\r\n    .onRecordingStarted { println("Started!") }\r\n    .onRecordingStopped { path -> println("Saved to: $path") }\r\n    .onError { message -> showError(message) }\r\n    .onStateChange { state -> updateUI(state) }\r\n    .build()\n'})}),"\n",(0,o.jsx)(r.h2,{id:"real-time-audio-access",children:"Real-time Audio Access"}),"\n",(0,o.jsx)(r.p,{children:"Access raw audio buffers for processing:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:"recorder.start()\r\n\r\nrecorder.audioBuffers.collect { buffer ->\r\n    val samples = FloatArray(buffer.sampleCount)\r\n    buffer.fillFloatSamples(samples)\r\n\r\n    // Process samples (pitch detection, visualization, etc.)\r\n    val pitch = detector.detect(samples, buffer.sampleRate)\r\n    updatePitchDisplay(pitch)\r\n}\n"})}),"\n",(0,o.jsx)(r.h2,{id:"echo-cancellation",children:"Echo Cancellation"}),"\n",(0,o.jsx)(r.p,{children:"When recording while playing audio (e.g., karaoke):"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:"val config = SonixRecorderConfig.Builder()\r\n    .echoCancellation(true)\r\n    .build()\r\n\r\nval recorder = SonixRecorder.create(path, config)\n"})}),"\n",(0,o.jsx)(r.p,{children:"This uses platform AEC to remove the backing track from the recording."}),"\n",(0,o.jsx)(r.h2,{id:"playback-synchronization",children:"Playback Synchronization"}),"\n",(0,o.jsx)(r.p,{children:"Sync recording timestamps with playback position:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:'val player = SonixPlayer.create("backing-track.mp3")\r\n\r\nval recorder = SonixRecorder.create(\r\n    "recording.m4a",\r\n    SonixRecorderConfig.Builder()\r\n        .playbackSyncProvider(player.asPlaybackInfoProvider)\r\n        .build()\r\n)\r\n\r\n// Timestamps in audioBuffers now align with player position\n'})}),"\n",(0,o.jsx)(r.h2,{id:"segment-recording",children:"Segment Recording"}),"\n",(0,o.jsx)(r.p,{children:"For practice apps that record individual segments:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:'val config = SonixRecorderConfig.Builder()\r\n    .enableSegmentRecording("/path/to/segments/")\r\n    .build()\r\n\r\nval recorder = SonixRecorder.create(path, config)\r\nrecorder.start()\r\n\r\n// Start segment 0\r\nrecorder.startRecordingSegment(0)\r\n\r\n// ... user sings segment ...\r\n\r\n// Stop segment and get path\r\nval segmentPath = recorder.stopRecordingSegment(0)\r\nprintln("Segment saved to: $segmentPath")\r\n\r\n// Start segment 1\r\nrecorder.startRecordingSegment(1)\r\n// ...\r\n\r\n// Get all recorded segments\r\nval segments = recorder.getRecordedSegments()\n'})}),"\n",(0,o.jsx)(r.h2,{id:"temporary-recording",children:"Temporary Recording"}),"\n",(0,o.jsx)(r.p,{children:"When you don't need a specific output path:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:"// Auto-generates temp path\r\nval recorder = SonixRecorder.createTemporary(SonixRecorderConfig.VOICE)\r\nrecorder.start()\r\n\r\n// ... record ...\r\n\r\nrecorder.stop()\r\n// File saved to temp directory\n"})}),"\n",(0,o.jsx)(r.h2,{id:"sample-rate-handling",children:"Sample Rate Handling"}),"\n",(0,o.jsx)(r.p,{children:"Hardware may use a different sample rate than requested:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:"recorder.start()\r\n\r\n// Check actual rate being used\r\nval actualRate = recorder.actualSampleRate  // e.g., 48000 instead of 16000\r\n\r\n// Audio buffers contain this rate\r\nrecorder.audioBuffers.collect { buffer ->\r\n    val rate = buffer.sampleRate  // Same as actualSampleRate\r\n}\n"})}),"\n",(0,o.jsx)(r.p,{children:"VoxaTrace handles encoding at the correct rate automatically."}),"\n",(0,o.jsx)(r.h2,{id:"platform-considerations",children:"Platform Considerations"}),"\n",(0,o.jsx)(r.h3,{id:"ios-1",children:"iOS"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"Audio session automatically configured for recording"}),"\n",(0,o.jsx)(r.li,{children:"Hardware may use 48kHz regardless of requested rate"}),"\n",(0,o.jsxs)(r.li,{children:["Check ",(0,o.jsx)(r.code,{children:"actualSampleRate"})," for true rate"]}),"\n"]}),"\n",(0,o.jsx)(r.h3,{id:"android-1",children:"Android"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"Sample rate depends on device capabilities"}),"\n",(0,o.jsx)(r.li,{children:"Some devices only support specific rates (44.1kHz, 48kHz)"}),"\n",(0,o.jsx)(r.li,{children:"Echo cancellation quality varies by device"}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,o.jsx)(r.h3,{id:"voice-memo-recorder",children:"Voice Memo Recorder"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:'class VoiceMemoRecorder(private val outputDir: String) {\r\n    private var recorder: SonixRecorder? = null\r\n\r\n    fun startRecording(filename: String) {\r\n        val path = "$outputDir/$filename.m4a"\r\n        recorder = SonixRecorder.create(path, SonixRecorderConfig.VOICE)\r\n        recorder?.start()\r\n    }\r\n\r\n    fun stopRecording(): String? {\r\n        val state = recorder?.state?.value\r\n        recorder?.stop()\r\n        recorder?.release()\r\n        recorder = null\r\n        return (state as? RecordingState.Finished)?.outputPath\r\n    }\r\n\r\n    fun isRecording(): Boolean = recorder?.isRecording?.value == true\r\n}\n'})}),"\n",(0,o.jsx)(r.h3,{id:"recording-with-pitch-detection",children:"Recording with Pitch Detection"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-kotlin",children:"class PitchRecorder {\r\n    private var recorder: SonixRecorder? = null\r\n    private var detector: CalibraPitch.Detector? = null\r\n    private val scope = CoroutineScope(Dispatchers.Default)\r\n\r\n    fun start(outputPath: String, onPitch: (Float) -> Unit) {\r\n        recorder = SonixRecorder.create(outputPath, SonixRecorderConfig.VOICE)\r\n        detector = CalibraPitch.createDetector()\r\n\r\n        recorder?.start()\r\n\r\n        scope.launch {\r\n            recorder?.audioBuffers?.collect { buffer ->\r\n                val samples = FloatArray(buffer.sampleCount)\r\n                buffer.fillFloatSamples(samples)\r\n\r\n                val point = detector?.detect(samples, buffer.sampleRate)\r\n                point?.let {\r\n                    withContext(Dispatchers.Main) {\r\n                        onPitch(it.pitch)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    fun stop() {\r\n        scope.cancel()\r\n        recorder?.stop()\r\n        recorder?.release()\r\n        detector?.close()\r\n    }\r\n}\n"})}),"\n",(0,o.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.a,{href:"./playing-audio",children:"Playing Audio Guide"})," - Playback features"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.a,{href:"../cookbook/voice-recorder",children:"Voice Recorder Recipe"})," - Complete example"]}),"\n"]})]})}function u(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(s,{...e})}):s(e)}},8453(e,r,n){n.d(r,{R:()=>a,x:()=>l});var i=n(6540);const o={},t=i.createContext(o);function a(e){const r=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),i.createElement(t.Provider,{value:r},e.children)}}}]);