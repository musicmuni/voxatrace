"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2365],{2704(e,n,r){r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>p,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"concepts/api-patterns","title":"API Patterns","description":"VoxaTrace APIs follow consistent patterns that make them predictable and easy to learn.","source":"@site/docs/concepts/api-patterns.md","sourceDirName":"concepts","slug":"/concepts/api-patterns","permalink":"/concepts/api-patterns","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"Live Evaluation","permalink":"/concepts/live-evaluation"},"next":{"title":"Audio Effects","permalink":"/concepts/audio-effects"}}');var a=r(4848),l=r(8453);const t={sidebar_position:4},i="API Patterns",o={},c=[{value:"The Three-Tier Pattern",id:"the-three-tier-pattern",level:2},{value:"Tier 1: Presets (80% of users)",id:"tier-1-presets-80-of-users",level:3},{value:"Tier 2: Builder (15% of users)",id:"tier-2-builder-15-of-users",level:3},{value:"Tier 3: .copy() (5% of users)",id:"tier-3-copy-5-of-users",level:3},{value:"Config + Factory Pattern",id:"config--factory-pattern",level:2},{value:"Presets",id:"presets",level:2},{value:"Resource Lifecycle",id:"resource-lifecycle",level:2},{value:"Create \u2192 Use \u2192 Release",id:"create--use--release",level:3},{value:"AutoCloseable Support",id:"autocloseable-support",level:3},{value:"Suspend Functions",id:"suspend-functions",level:3},{value:"Ownership",id:"ownership",level:2},{value:"Owned Resources",id:"owned-resources",level:3},{value:"Borrowed Resources",id:"borrowed-resources",level:3},{value:"StateFlow Observation",id:"stateflow-observation",level:2},{value:"Callbacks vs StateFlows",id:"callbacks-vs-stateflows",level:2},{value:"StateFlows (Reactive)",id:"stateflows-reactive",level:3},{value:"Callbacks (Event-based)",id:"callbacks-event-based",level:3},{value:"Sample Rate Handling",id:"sample-rate-handling",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Return Values",id:"return-values",level:3},{value:"StateFlow",id:"stateflow",level:3},{value:"Callbacks",id:"callbacks",level:3},{value:"Swift Interop",id:"swift-interop",level:2},{value:"Companion Objects",id:"companion-objects",level:3},{value:"Named Parameters",id:"named-parameters",level:3},{value:"Suspending Functions",id:"suspending-functions",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"api-patterns",children:"API Patterns"})}),"\n",(0,a.jsx)(n.p,{children:"VoxaTrace APIs follow consistent patterns that make them predictable and easy to learn."}),"\n",(0,a.jsx)(n.h2,{id:"the-three-tier-pattern",children:"The Three-Tier Pattern"}),"\n",(0,a.jsx)(n.p,{children:"Every VoxaTrace API supports three usage tiers, letting you choose the right level of complexity for your needs."}),"\n",(0,a.jsx)(n.h3,{id:"tier-1-presets-80-of-users",children:"Tier 1: Presets (80% of users)"}),"\n",(0,a.jsx)(n.p,{children:"Use predefined configurations. Zero learning curve."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:'// Just works with sensible defaults\r\nval player = SonixPlayer.create("song.mp3")\r\nval detector = CalibraPitch.createDetector()\r\nval recorder = SonixRecorder.create("/path/to/output.m4a")\n'})}),"\n",(0,a.jsx)(n.h3,{id:"tier-2-builder-15-of-users",children:"Tier 2: Builder (15% of users)"}),"\n",(0,a.jsx)(n.p,{children:"Discover options through IDE autocomplete. Type-safe configuration."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// Explore options with autocomplete\r\nval config = PitchDetectorConfig.Builder()\r\n    .algorithm(PitchAlgorithm.SWIFT_F0)\r\n    .voiceType(VoiceType.WesternSoprano)\r\n    .enableProcessing()\r\n    .build()\r\n\r\nval detector = CalibraPitch.createDetector(config, modelProvider = { ... })\n"})}),"\n",(0,a.jsx)(n.h3,{id:"tier-3-copy-5-of-users",children:"Tier 3: .copy() (5% of users)"}),"\n",(0,a.jsx)(n.p,{children:"Direct access to all parameters. For power users who know exactly what they want."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// Precise control when you need it\r\nval config = PitchDetectorConfig.PRECISE.copy(\r\n    confidenceThreshold = 0.6f,\r\n    amplitudeGateDb = -50f\r\n)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"config--factory-pattern",children:"Config + Factory Pattern"}),"\n",(0,a.jsxs)(n.p,{children:["APIs separate ",(0,a.jsx)(n.strong,{children:"configuration"})," from ",(0,a.jsx)(n.strong,{children:"creation"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// Config is immutable data\r\ndata class SonixPlayerConfig(\r\n    val volume: Float = 1f,\r\n    val pitch: Float = 0f,\r\n    val tempo: Float = 1f\r\n)\r\n\r\n// Factory creates the instance\r\nval player = SonixPlayer.create(source, config)\n"})}),"\n",(0,a.jsx)(n.p,{children:"Benefits:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Reusable configs"}),": Create once, use many times"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Testable"}),": Pass mock configs in tests"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Discoverable"}),": Builder shows all options"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"presets",children:"Presets"}),"\n",(0,a.jsx)(n.p,{children:"Each config class provides static presets for common use cases:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// Player presets\r\nSonixPlayerConfig.DEFAULT   // Play once at normal volume\r\nSonixPlayerConfig.LOOPING   // Infinite loop\r\n\r\n// Recorder presets\r\nSonixRecorderConfig.VOICE     // 16kHz mono for speech/singing\r\nSonixRecorderConfig.STANDARD  // 44.1kHz stereo\r\nSonixRecorderConfig.HIGH      // 48kHz stereo high fidelity\r\n\r\n// Detector presets\r\nPitchDetectorConfig.BALANCED  // Good tradeoff\r\nPitchDetectorConfig.PRECISE   // Higher accuracy, more CPU\r\nPitchDetectorConfig.RELAXED      // Lower latency, less accuracy\n"})}),"\n",(0,a.jsx)(n.p,{children:"Start with presets, then customize with Builder if needed."}),"\n",(0,a.jsx)(n.h2,{id:"resource-lifecycle",children:"Resource Lifecycle"}),"\n",(0,a.jsx)(n.p,{children:"All resources follow consistent lifecycle patterns:"}),"\n",(0,a.jsx)(n.h3,{id:"create--use--release",children:"Create \u2192 Use \u2192 Release"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:'// Create\r\nval player = SonixPlayer.create("song.mp3")\r\n\r\n// Use\r\nplayer.play()\r\nplayer.pause()\r\n\r\n// Release (ALWAYS do this!)\r\nplayer.release()\n'})}),"\n",(0,a.jsx)(n.h3,{id:"autocloseable-support",children:"AutoCloseable Support"}),"\n",(0,a.jsxs)(n.p,{children:["Use Kotlin's ",(0,a.jsx)(n.code,{children:"use"})," block for automatic cleanup:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"CalibraPitch.createDetector().use { detector ->\r\n    val point = detector.detect(samples, sampleRate)\r\n    // detector.close() called automatically\r\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"suspend-functions",children:"Suspend Functions"}),"\n",(0,a.jsxs)(n.p,{children:["Some creation functions are suspending (marked with ",(0,a.jsx)(n.code,{children:"suspend"}),"):"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:'// Player loading is async (decodes audio)\r\nsuspend fun createPlayer() {\r\n    val player = SonixPlayer.create("song.mp3")  // suspend\r\n    player.play()\r\n}\r\n\r\n// Session preparation is async (extracts features)\r\nsuspend fun startSession() {\r\n    val session = CalibraLiveEval.create(...)\r\n    session.prepareSession()  // suspend\r\n    session.startPracticingSegment(0)\r\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"ownership",children:"Ownership"}),"\n",(0,a.jsxs)(n.p,{children:["Resources are either ",(0,a.jsx)(n.strong,{children:"owned"})," or ",(0,a.jsx)(n.strong,{children:"borrowed"}),":"]}),"\n",(0,a.jsx)(n.h3,{id:"owned-resources",children:"Owned Resources"}),"\n",(0,a.jsx)(n.p,{children:"The receiving object is responsible for cleanup:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// CalibraLiveEval OWNS the detector\r\nval session = CalibraLiveEval.create(\r\n    reference = material,\r\n    detector = detector  // Session takes ownership\r\n)\r\nsession.closeSession()  // Detector is released here\n"})}),"\n",(0,a.jsx)(n.h3,{id:"borrowed-resources",children:"Borrowed Resources"}),"\n",(0,a.jsx)(n.p,{children:"The caller remains responsible for cleanup:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// CalibraLiveEval BORROWS player and recorder\r\nval session = CalibraLiveEval.create(\r\n    reference = material,\r\n    detector = detector,\r\n    player = player,      // Caller owns\r\n    recorder = recorder   // Caller owns\r\n)\r\n\r\nsession.closeSession()       // Only releases detector\r\nplayer.release()      // Caller must release\r\nrecorder.release()    // Caller must release\n"})}),"\n",(0,a.jsx)(n.p,{children:"The documentation and KDoc always specify ownership."}),"\n",(0,a.jsx)(n.h2,{id:"stateflow-observation",children:"StateFlow Observation"}),"\n",(0,a.jsx)(n.p,{children:"Real-time state is exposed via Kotlin StateFlows:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// Observe playback position\r\nplayer.currentTime.collect { timeMs ->\r\n    updateSeekBar(timeMs)\r\n}\r\n\r\n// Observe recording level\r\nrecorder.level.collect { level ->\r\n    updateVuMeter(level)\r\n}\r\n\r\n// Observe session state\r\nsession.state.collect { state ->\r\n    updateUI(state)\r\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"In Swift, use the provided async sequences:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-swift",children:"for await timeMs in player.currentTimeStream() {\r\n    updateSeekBar(timeMs)\r\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"callbacks-vs-stateflows",children:"Callbacks vs StateFlows"}),"\n",(0,a.jsx)(n.p,{children:"Both are available. Choose based on preference:"}),"\n",(0,a.jsx)(n.h3,{id:"stateflows-reactive",children:"StateFlows (Reactive)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// Observe all updates\r\nsession.phase.collect { phase ->\r\n    updatePhaseUI(phase)\r\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"callbacks-event-based",children:"Callbacks (Event-based)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// Register specific handlers\r\nsession.onPhaseChanged { phase ->\r\n    updatePhaseUI(phase)\r\n}\r\n\r\nsession.onSegmentComplete { result ->\r\n    showScore(result)\r\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"sample-rate-handling",children:"Sample Rate Handling"}),"\n",(0,a.jsx)(n.p,{children:"VoxaTrace handles sample rate conversions internally:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// Pass any sample rate - internal resampling to 16kHz\r\nval point = detector.detect(samples, sampleRate = 48000)\r\n\r\n// Works the same\r\nval point = detector.detect(samples, sampleRate = 44100)\r\nval point = detector.detect(samples, sampleRate = 16000)\n"})}),"\n",(0,a.jsx)(n.p,{children:"This means you don't need to resample audio yourself. Just pass the hardware sample rate."}),"\n",(0,a.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,a.jsx)(n.p,{children:"Errors are communicated via:"}),"\n",(0,a.jsx)(n.h3,{id:"return-values",children:"Return Values"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"val result = session.finishPracticingSegment()\r\nif (result == null) {\r\n    // Session wasn't in PRACTICING state\r\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"stateflow",children:"StateFlow"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"player.error.collect { error ->\r\n    if (error != null) {\r\n        showError(error.message)\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"callbacks",children:"Callbacks"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"SonixPlayerConfig.Builder()\r\n    .onError { message -> showError(message) }\r\n    .build()\n"})}),"\n",(0,a.jsx)(n.h2,{id:"swift-interop",children:"Swift Interop"}),"\n",(0,a.jsx)(n.p,{children:"Kotlin Multiplatform generates Swift-friendly APIs. Some patterns to note:"}),"\n",(0,a.jsx)(n.h3,{id:"companion-objects",children:"Companion Objects"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// Kotlin\r\nSonixPlayer.create(...)\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-swift",children:'// Swift (extensions hide .companion)\r\nSonixPlayer.create(source: "song.mp3")\n'})}),"\n",(0,a.jsx)(n.h3,{id:"named-parameters",children:"Named Parameters"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// Kotlin\r\ndetector.detect(samples, sampleRate = 48000)\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-swift",children:"// Swift\r\ndetector.detect(samples: samples, sampleRate: 48000)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"suspending-functions",children:"Suspending Functions"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// Kotlin\r\nsuspend fun create(): SonixPlayer\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-swift",children:"// Swift (async/await)\r\nfunc create() async throws -> SonixPlayer\n"})}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"../getting-started/installation",children:"Installation"})," - Set up VoxaTrace"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"../getting-started/android-quickstart",children:"Android Quickstart"})," - Your first app"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"../getting-started/ios-quickstart",children:"iOS Quickstart"})," - Your first iOS app"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>t,x:()=>i});var s=r(6540);const a={},l=s.createContext(a);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);