"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[7717],{8343(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"concepts/live-evaluation","title":"Live Evaluation","description":"Live evaluation scores singing in real-time by comparing the singer\'s pitch to a reference melody.","source":"@site/docs/concepts/live-evaluation.md","sourceDirName":"concepts","slug":"/concepts/live-evaluation","permalink":"/concepts/live-evaluation","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Voice Activity Detection","permalink":"/concepts/voice-activity"},"next":{"title":"API Patterns","permalink":"/concepts/api-patterns"}}');var i=r(4848),t=r(8453);const l={sidebar_position:3},a="Live Evaluation",c={},o=[{value:"What is Live Evaluation?",id:"what-is-live-evaluation",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Key Concepts",id:"key-concepts",level:2},{value:"Segments",id:"segments",level:3},{value:"Practice Modes",id:"practice-modes",level:3},{value:"Singalong Mode",id:"singalong-mode",level:4},{value:"Singafter Mode",id:"singafter-mode",level:4},{value:"Scores",id:"scores",level:3},{value:"Session Lifecycle",id:"session-lifecycle",level:2},{value:"1. Create Session",id:"1-create-session",level:3},{value:"2. Prepare (Load Reference)",id:"2-prepare-load-reference",level:3},{value:"3. Practice Segment",id:"3-practice-segment",level:3},{value:"4. Cleanup",id:"4-cleanup",level:3},{value:"API Modes",id:"api-modes",level:2},{value:"Low-Level API",id:"low-level-api",level:3},{value:"Convenience API",id:"convenience-api",level:3},{value:"Observing State",id:"observing-state",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Auto-Advance",id:"auto-advance",level:3},{value:"Score Threshold",id:"score-threshold",level:3},{value:"Key Transposition",id:"key-transposition",level:3},{value:"Segment Result",id:"segment-result",level:2},{value:"Ownership Model",id:"ownership-model",level:2},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Retry Segment",id:"retry-segment",level:3},{value:"Seek to Segment",id:"seek-to-segment",level:3},{value:"Cancel Mid-Segment",id:"cancel-mid-segment",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"live-evaluation",children:"Live Evaluation"})}),"\n",(0,i.jsx)(n.p,{children:"Live evaluation scores singing in real-time by comparing the singer's pitch to a reference melody."}),"\n",(0,i.jsx)(n.h2,{id:"what-is-live-evaluation",children:"What is Live Evaluation?"}),"\n",(0,i.jsxs)(n.p,{children:["Live evaluation answers: ",(0,i.jsx)(n.strong,{children:'"How accurately is this person singing the reference melody?"'})]}),"\n",(0,i.jsx)(n.p,{children:"It works by:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Extracting pitch from the reference audio (what they should sing)"}),"\n",(0,i.jsx)(n.li,{children:"Detecting pitch from the student in real-time (what they're singing)"}),"\n",(0,i.jsx)(n.li,{children:"Comparing the two and calculating a score"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"App Type"}),(0,i.jsx)(n.th,{children:"How Live Evaluation Helps"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Karaoke"})}),(0,i.jsx)(n.td,{children:"Show score as users sing along"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Music education"})}),(0,i.jsx)(n.td,{children:"Provide instant feedback on pitch accuracy"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Practice apps"})}),(0,i.jsx)(n.td,{children:"Track improvement over multiple attempts"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Singing games"})}),(0,i.jsx)(n.td,{children:"Gamify pitch accuracy"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,i.jsx)(n.h3,{id:"segments",children:"Segments"}),"\n",(0,i.jsxs)(n.p,{children:["Songs are divided into ",(0,i.jsx)(n.strong,{children:"segments"})," - typically phrases or sections. Each segment is evaluated independently."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Song Timeline:\r\n[Segment 0: "Happy birthday"] [Segment 1: "to you"] [Segment 2: "Happy birthday"]\r\n     \u2193                              \u2193                        \u2193\r\n   Score: 85%                    Score: 92%               Score: 78%\n'})}),"\n",(0,i.jsx)(n.p,{children:"Benefits of segmentation:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Users can retry individual segments"}),"\n",(0,i.jsx)(n.li,{children:"Granular feedback per phrase"}),"\n",(0,i.jsx)(n.li,{children:"Easier progress tracking"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"practice-modes",children:"Practice Modes"}),"\n",(0,i.jsx)(n.h4,{id:"singalong-mode",children:"Singalong Mode"}),"\n",(0,i.jsxs)(n.p,{children:["User sings ",(0,i.jsx)(n.strong,{children:"simultaneously"})," with the reference audio."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Reference: \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500>\r\nStudent:   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500>\r\n           ^                         ^\r\n         Start                      End\n"})}),"\n",(0,i.jsx)(n.p,{children:"Best for: Karaoke-style apps where users sing along with music."}),"\n",(0,i.jsx)(n.h4,{id:"singafter-mode",children:"Singafter Mode"}),"\n",(0,i.jsxs)(n.p,{children:["User ",(0,i.jsx)(n.strong,{children:"listens first"}),", then sings back the phrase."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Reference: \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500>\r\nStudent:            \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500>\r\n           ^        ^        ^\r\n        Listen   Start     End\n"})}),"\n",(0,i.jsx)(n.p,{children:"Best for: Ear training apps where users echo what they hear."}),"\n",(0,i.jsx)(n.h3,{id:"scores",children:"Scores"}),"\n",(0,i.jsx)(n.p,{children:"Live evaluation returns several score types:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Score"}),(0,i.jsx)(n.th,{children:"What It Measures"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Overall Score"})}),(0,i.jsx)(n.td,{children:"Combined pitch + timing accuracy (0.0 to 1.0)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Pitch Accuracy"})}),(0,i.jsx)(n.td,{children:"How many notes matched the reference pitch"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Performance Level"})}),(0,i.jsx)(n.td,{children:"Qualitative rating (NEEDS_WORK, FAIR, GOOD, VERY_GOOD, EXCELLENT)"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"session-lifecycle",children:"Session Lifecycle"}),"\n",(0,i.jsx)(n.h3,{id:"1-create-session",children:"1. Create Session"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Create pitch detector\r\nval detector = CalibraPitch.createDetector()\r\n\r\n// Create session with reference material\r\nval session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,  // Contains audio + segment info\r\n    detector = detector\r\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-prepare-load-reference",children:"2. Prepare (Load Reference)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Suspending - extracts features from reference audio\r\nsession.prepareSession()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-practice-segment",children:"3. Practice Segment"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:'// Start practicing segment 0\r\nsession.startPracticingSegment(0)\r\n\r\n// Feed audio from recorder\r\nrecorder.audioBuffers.collect { buffer ->\r\n    session.feedAudioSamples(buffer.toFloatArray(), buffer.sampleRate)\r\n}\r\n\r\n// End segment and get result\r\nval result = session.finishPracticingSegment()\r\nprintln("Score: ${result?.score}")\n'})}),"\n",(0,i.jsx)(n.h3,{id:"4-cleanup",children:"4. Cleanup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"session.closeSession()  // Releases detector and resources\n"})}),"\n",(0,i.jsx)(n.h2,{id:"api-modes",children:"API Modes"}),"\n",(0,i.jsx)(n.h3,{id:"low-level-api",children:"Low-Level API"}),"\n",(0,i.jsx)(n.p,{children:"Full control over audio flow. You manage player and recorder."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"val session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,\r\n    detector = CalibraPitch.createDetector()\r\n)\r\n\r\nsession.prepareSession()\r\nsession.startPracticingSegment(0)\r\n\r\n// You control when audio is fed\r\nmyRecorder.audioFlow.collect { buffer ->\r\n    session.feedAudioSamples(buffer.samples, buffer.sampleRate)\r\n}\r\n\r\nval result = session.finishPracticingSegment()\r\nsession.closeSession()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"convenience-api",children:"Convenience API"}),"\n",(0,i.jsx)(n.p,{children:"Library coordinates playback, recording, and scoring automatically."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"val session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,\r\n    detector = CalibraPitch.createDetector(),\r\n    player = myPlayer,      // Library controls playback\r\n    recorder = myRecorder   // Library controls recording\r\n)\r\n\r\nsession.prepareSession()\r\n\r\n// Register callbacks\r\nsession.onSegmentComplete { result ->\r\n    showScore(result.score)\r\n}\r\n\r\n// Single call handles everything\r\nsession.startPracticingSegment(0)  // Starts practicing the first segment\n"})}),"\n",(0,i.jsx)(n.h2,{id:"observing-state",children:"Observing State"}),"\n",(0,i.jsx)(n.p,{children:"Use StateFlows to observe session state in your UI:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Observe session phase\r\nsession.state.collect { state ->\r\n    when (state.phase) {\r\n        SessionPhase.IDLE -> showIdleUI()\r\n        SessionPhase.READY -> showReadyUI()\r\n        SessionPhase.PRACTICING -> showPracticingUI(state.segmentProgress)\r\n        SessionPhase.BETWEEN_SEGMENTS -> showScoreUI()\r\n        SessionPhase.COMPLETED -> showCompletionUI()\r\n    }\r\n}\r\n\r\n// Observe live pitch for visualization\r\nsession.livePitchContour.collect { contour ->\r\n    drawPitchCurve(contour)\r\n}\r\n\r\n// Observe practice phase (singalong/singafter)\r\nsession.phase.collect { phase ->\r\n    when (phase) {\r\n        PracticePhase.IDLE -> // Waiting\r\n        PracticePhase.LISTENING -> // Listening to reference\r\n        PracticePhase.SINGING -> // User is singing\r\n        PracticePhase.EVALUATED -> // Segment finished\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"auto-advance",children:"Auto-Advance"}),"\n",(0,i.jsx)(n.p,{children:"Automatically move to next segment after scoring:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"val session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,\r\n    session = SessionConfig.Builder()\r\n        .autoAdvance(true)\r\n        .build(),\r\n    detector = detector\r\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"score-threshold",children:"Score Threshold"}),"\n",(0,i.jsx)(n.p,{children:"Require minimum score before advancing (for practice apps):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"val session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,\r\n    session = SessionConfig.Builder()\r\n        .scoreThreshold(0.7f)  // Must score 70% to advance\r\n        .maxAttempts(3)        // Allow 3 retries\r\n        .build(),\r\n    detector = detector\r\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"key-transposition",children:"Key Transposition"}),"\n",(0,i.jsx)(n.p,{children:"When student sings in a different key than reference:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Student sings 2 semitones lower\r\nsession.setStudentKeyHz(referenceKeyHz * 0.89f)  // 2 semitones down = 0.89x\n"})}),"\n",(0,i.jsx)(n.h2,{id:"segment-result",children:"Segment Result"}),"\n",(0,i.jsx)(n.p,{children:"Each segment returns detailed results:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"data class SegmentResult(\r\n    val segment: Segment,           // Which segment\r\n    val score: Float,               // Overall score (0.0 to 1.0)\r\n    val pitchAccuracy: Float,       // Pitch accuracy (0.0 to 1.0)\r\n    val level: PerformanceLevel,    // NEEDS_WORK, FAIR, GOOD, VERY_GOOD, EXCELLENT\r\n    val attemptNumber: Int,         // Which attempt this was\r\n    val referencePitch: PitchContour,  // What they should have sung\r\n    val studentPitch: PitchContour     // What they actually sung\r\n)\n"})}),"\n",(0,i.jsx)(n.p,{children:"Use pitch contours for visualization:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"session.onSegmentComplete { result ->\r\n    // Draw reference and student pitch on same graph\r\n    drawPitchComparison(\r\n        reference = result.referencePitch,\r\n        student = result.studentPitch\r\n    )\r\n\r\n    // Show score\r\n    showScore(result.score, result.level)\r\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"ownership-model",children:"Ownership Model"}),"\n",(0,i.jsx)(n.p,{children:"Understanding resource ownership prevents memory leaks:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Resource"}),(0,i.jsx)(n.th,{children:"Owned By"}),(0,i.jsx)(n.th,{children:"Cleanup"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Detector"}),(0,i.jsx)(n.td,{children:"Session"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"session.closeSession()"})," releases it"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Player"}),(0,i.jsx)(n.td,{children:"Caller"}),(0,i.jsxs)(n.td,{children:["You call ",(0,i.jsx)(n.code,{children:"player.release()"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Recorder"}),(0,i.jsx)(n.td,{children:"Caller"}),(0,i.jsxs)(n.td,{children:["You call ",(0,i.jsx)(n.code,{children:"recorder.release()"})]})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Correct cleanup order\r\nsession.closeSession()       // Releases detector\r\nplayer.release()      // You manage player\r\nrecorder.release()    // You manage recorder\n"})}),"\n",(0,i.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"retry-segment",children:"Retry Segment"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"session.onSegmentComplete { result ->\r\n    if (result.score < 0.7f) {\r\n        showRetryButton {\r\n            session.retryCurrentSegment()\r\n        }\r\n    } else {\r\n        session.startPracticingSegment(result.segment.index + 1)\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"seek-to-segment",children:"Seek to Segment"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Jump to any segment\r\nsegmentButtons.forEachIndexed { index, button ->\r\n    button.onClick {\r\n        session.startPracticingSegment(index)\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cancel-mid-segment",children:"Cancel Mid-Segment"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"cancelButton.onClick {\r\n    session.discardCurrentSegment()  // Discards the current attempt\r\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../guides/live-evaluation",children:"Live Evaluation Guide"})," - Implementation walkthrough"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../cookbook/karaoke-app",children:"Karaoke App Recipe"})," - Complete example"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>l,x:()=>a});var s=r(6540);const i={},t=s.createContext(i);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);