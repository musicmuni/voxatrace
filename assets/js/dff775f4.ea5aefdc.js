"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[31506],{23912(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>f,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"cookbook/tuner-app","title":"Tuner App","description":"Build a chromatic tuner that shows the current note and how many cents sharp/flat.","source":"@site/docs/cookbook/tuner-app.md","sourceDirName":"cookbook","slug":"/cookbook/tuner-app","permalink":"/voxatrace/docs/cookbook/tuner-app","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Karaoke App","permalink":"/voxatrace/docs/cookbook/karaoke-app"},"next":{"title":"Voice Recorder","permalink":"/voxatrace/docs/cookbook/voice-recorder"}}');var o=r(74848),i=r(28453);const a={sidebar_position:2},s="Tuner App",l={},c=[{value:"What You&#39;ll Build",id:"what-youll-build",level:2},{value:"Implementation",id:"implementation",level:2},{value:"ViewModel",id:"viewmodel",level:3},{value:"UI (Compose)",id:"ui-compose",level:3},{value:"Swift (SwiftUI)",id:"swift-swiftui",level:3},{value:"Enhancements",id:"enhancements",level:2},{value:"Reference Pitch Selection",id:"reference-pitch-selection",level:3},{value:"Instrument Modes",id:"instrument-modes",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"tuner-app",children:"Tuner App"})}),"\n",(0,o.jsx)(n.p,{children:"Build a chromatic tuner that shows the current note and how many cents sharp/flat."}),"\n",(0,o.jsx)(n.h2,{id:"what-youll-build",children:"What You'll Build"}),"\n",(0,o.jsx)(n.p,{children:"A classic tuner display:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Shows current note (C4, A#3, etc.)"}),"\n",(0,o.jsx)(n.li,{children:"Displays frequency in Hz"}),"\n",(0,o.jsx)(n.li,{children:"Shows cents offset (-50 to +50)"}),"\n",(0,o.jsx)(n.li,{children:"Visual needle/gauge showing pitch accuracy"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"implementation",children:"Implementation"}),"\n",(0,o.jsx)(n.h3,{id:"viewmodel",children:"ViewModel"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-kotlin",children:'class TunerViewModel : ViewModel() {\r\n    private var detector: CalibraPitch.Detector? = null\r\n    private var recorder: SonixRecorder? = null\r\n\r\n    private val _state = MutableStateFlow(TunerState())\r\n    val state: StateFlow<TunerState> = _state.asStateFlow()\r\n\r\n    data class TunerState(\r\n        val isActive: Boolean = false,\r\n        val note: String = "--",\r\n        val octave: Int = 0,\r\n        val frequency: Float = 0f,\r\n        val centsOff: Int = 0,\r\n        val confidence: Float = 0f\r\n    )\r\n\r\n    fun start() {\r\n        detector = CalibraPitch.createDetector(\r\n            PitchDetectorConfig.Builder()\r\n                .algorithm(PitchAlgorithm.YIN)\r\n                .enableProcessing()  // Smoothing for stable display\r\n                .build()\r\n        )\r\n\r\n        recorder = SonixRecorder.createTemporary(SonixRecorderConfig.VOICE)\r\n        recorder?.start()\r\n\r\n        _state.update { it.copy(isActive = true) }\r\n\r\n        viewModelScope.launch {\r\n            recorder?.audioBuffers?.collect { buffer ->\r\n                val samples = FloatArray(buffer.sampleCount)\r\n                buffer.fillFloatSamples(samples)\r\n\r\n                val point = detector?.detect(samples, buffer.sampleRate) ?: return@collect\r\n\r\n                if (point.pitch > 0 && point.confidence > 0.5f) {\r\n                    val noteInfo = pitchToNoteInfo(point.pitch)\r\n                    _state.update {\r\n                        it.copy(\r\n                            note = noteInfo.name,\r\n                            octave = noteInfo.octave,\r\n                            frequency = point.pitch,\r\n                            centsOff = noteInfo.cents,\r\n                            confidence = point.confidence\r\n                        )\r\n                    }\r\n                } else {\r\n                    _state.update {\r\n                        it.copy(\r\n                            note = "--",\r\n                            octave = 0,\r\n                            frequency = 0f,\r\n                            centsOff = 0,\r\n                            confidence = 0f\r\n                        )\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    fun stop() {\r\n        _state.update { it.copy(isActive = false) }\r\n        recorder?.stop()\r\n        recorder?.release()\r\n        detector?.close()\r\n        recorder = null\r\n        detector = null\r\n    }\r\n\r\n    private fun pitchToNoteInfo(frequency: Float): NoteInfo {\r\n        val noteNames = arrayOf("C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B")\r\n        val a4 = 440.0\r\n\r\n        // Calculate semitones from A4\r\n        val semitones = 12 * kotlin.math.log2(frequency / a4) + 69\r\n\r\n        // Get note and octave\r\n        val noteIndex = ((semitones.toInt() % 12) + 12) % 12\r\n        val octave = (semitones.toInt() / 12) - 1\r\n\r\n        // Calculate cents offset from perfect pitch\r\n        val perfectSemitone = semitones.toInt()\r\n        val cents = ((semitones - perfectSemitone) * 100).toInt()\r\n\r\n        // Normalize cents to -50 to +50 range\r\n        val normalizedCents = if (cents > 50) cents - 100 else cents\r\n\r\n        return NoteInfo(\r\n            name = noteNames[noteIndex],\r\n            octave = octave,\r\n            cents = normalizedCents\r\n        )\r\n    }\r\n\r\n    data class NoteInfo(\r\n        val name: String,\r\n        val octave: Int,\r\n        val cents: Int\r\n    )\r\n\r\n    override fun onCleared() {\r\n        stop()\r\n    }\r\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"ui-compose",children:"UI (Compose)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-kotlin",children:'@Composable\r\nfun TunerScreen(viewModel: TunerViewModel = viewModel()) {\r\n    val state by viewModel.state.collectAsState()\r\n\r\n    Column(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .background(Color.Black),\r\n        horizontalAlignment = Alignment.CenterHorizontally,\r\n        verticalArrangement = Arrangement.Center\r\n    ) {\r\n        // Note display\r\n        Text(\r\n            text = if (state.note != "--") "${state.note}${state.octave}" else "--",\r\n            fontSize = 96.sp,\r\n            fontWeight = FontWeight.Bold,\r\n            color = Color.White\r\n        )\r\n\r\n        Spacer(modifier = Modifier.height(16.dp))\r\n\r\n        // Frequency display\r\n        Text(\r\n            text = if (state.frequency > 0) "${state.frequency.toInt()} Hz" else "-- Hz",\r\n            fontSize = 24.sp,\r\n            color = Color.Gray\r\n        )\r\n\r\n        Spacer(modifier = Modifier.height(32.dp))\r\n\r\n        // Cents gauge\r\n        TunerGauge(\r\n            cents = state.centsOff,\r\n            modifier = Modifier.size(250.dp)\r\n        )\r\n\r\n        // Cents text\r\n        Text(\r\n            text = when {\r\n                state.centsOff > 0 -> "+${state.centsOff} cents"\r\n                state.centsOff < 0 -> "${state.centsOff} cents"\r\n                else -> "In tune"\r\n            },\r\n            fontSize = 18.sp,\r\n            color = when {\r\n                kotlin.math.abs(state.centsOff) <= 5 -> Color.Green\r\n                kotlin.math.abs(state.centsOff) <= 15 -> Color.Yellow\r\n                else -> Color.Red\r\n            }\r\n        )\r\n\r\n        Spacer(modifier = Modifier.height(48.dp))\r\n\r\n        // Start/Stop button\r\n        Button(\r\n            onClick = {\r\n                if (state.isActive) viewModel.stop() else viewModel.start()\r\n            }\r\n        ) {\r\n            Text(if (state.isActive) "Stop" else "Start")\r\n        }\r\n    }\r\n}\r\n\r\n@Composable\r\nfun TunerGauge(cents: Int, modifier: Modifier = Modifier) {\r\n    Canvas(modifier = modifier) {\r\n        val center = Offset(size.width / 2, size.height / 2)\r\n        val radius = size.minDimension / 2 - 20\r\n\r\n        // Draw tick marks\r\n        for (i in -50..50 step 10) {\r\n            val angle = (i / 50f) * 90f - 90f  // -90 to +90 degrees\r\n            val radians = Math.toRadians(angle.toDouble())\r\n            val start = Offset(\r\n                center.x + (radius - 20) * cos(radians).toFloat(),\r\n                center.y + (radius - 20) * sin(radians).toFloat()\r\n            )\r\n            val end = Offset(\r\n                center.x + radius * cos(radians).toFloat(),\r\n                center.y + radius * sin(radians).toFloat()\r\n            )\r\n            drawLine(Color.Gray, start, end, strokeWidth = if (i == 0) 4f else 2f)\r\n        }\r\n\r\n        // Draw needle\r\n        val needleAngle = (cents.coerceIn(-50, 50) / 50f) * 90f - 90f\r\n        val needleRadians = Math.toRadians(needleAngle.toDouble())\r\n        val needleEnd = Offset(\r\n            center.x + (radius - 30) * cos(needleRadians).toFloat(),\r\n            center.y + (radius - 30) * sin(needleRadians).toFloat()\r\n        )\r\n\r\n        drawLine(\r\n            color = when {\r\n                kotlin.math.abs(cents) <= 5 -> Color.Green\r\n                kotlin.math.abs(cents) <= 15 -> Color.Yellow\r\n                else -> Color.Red\r\n            },\r\n            start = center,\r\n            end = needleEnd,\r\n            strokeWidth = 4f,\r\n            cap = StrokeCap.Round\r\n        )\r\n\r\n        // Draw center circle\r\n        drawCircle(Color.White, radius = 8f, center = center)\r\n    }\r\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"swift-swiftui",children:"Swift (SwiftUI)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-swift",children:'struct TunerView: View {\r\n    @StateObject private var viewModel = TunerViewModel()\r\n\r\n    var body: some View {\r\n        ZStack {\r\n            Color.black.ignoresSafeArea()\r\n\r\n            VStack(spacing: 20) {\r\n                // Note display\r\n                Text(viewModel.state.note != "--"\r\n                    ? "\\(viewModel.state.note)\\(viewModel.state.octave)"\r\n                    : "--")\r\n                    .font(.system(size: 96, weight: .bold))\r\n                    .foregroundColor(.white)\r\n\r\n                // Frequency\r\n                Text(viewModel.state.frequency > 0\r\n                    ? "\\(Int(viewModel.state.frequency)) Hz"\r\n                    : "-- Hz")\r\n                    .font(.title2)\r\n                    .foregroundColor(.gray)\r\n\r\n                // Gauge\r\n                TunerGaugeView(cents: viewModel.state.centsOff)\r\n                    .frame(width: 250, height: 150)\r\n\r\n                // Cents label\r\n                Text(centsLabel)\r\n                    .font(.title3)\r\n                    .foregroundColor(centsColor)\r\n\r\n                Spacer()\r\n\r\n                // Start/Stop button\r\n                Button(viewModel.state.isActive ? "Stop" : "Start") {\r\n                    if viewModel.state.isActive {\r\n                        viewModel.stop()\r\n                    } else {\r\n                        Task { await viewModel.start() }\r\n                    }\r\n                }\r\n                .buttonStyle(.borderedProminent)\r\n            }\r\n            .padding()\r\n        }\r\n    }\r\n\r\n    private var centsLabel: String {\r\n        switch viewModel.state.centsOff {\r\n        case let c where c > 0: return "+\\(c) cents"\r\n        case let c where c < 0: return "\\(c) cents"\r\n        default: return "In tune"\r\n        }\r\n    }\r\n\r\n    private var centsColor: Color {\r\n        let cents = abs(viewModel.state.centsOff)\r\n        if cents <= 5 { return .green }\r\n        if cents <= 15 { return .yellow }\r\n        return .red\r\n    }\r\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"enhancements",children:"Enhancements"}),"\n",(0,o.jsx)(n.h3,{id:"reference-pitch-selection",children:"Reference Pitch Selection"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-kotlin",children:"// A4 = 440 Hz is standard, but orchestras often use 442 Hz\r\nvar a4Reference = 440f\r\n\r\nprivate fun pitchToNoteInfo(frequency: Float): NoteInfo {\r\n    val semitones = 12 * kotlin.math.log2(frequency / a4Reference) + 69\r\n    // ... rest of calculation\r\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"instrument-modes",children:"Instrument Modes"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-kotlin",children:'enum class TunerMode {\r\n    CHROMATIC,  // All notes\r\n    GUITAR,     // E A D G B E\r\n    BASS,       // E A D G\r\n    UKULELE     // G C E A\r\n}\r\n\r\nval guitarNotes = listOf(\r\n    82.41f to "E2",\r\n    110.0f to "A2",\r\n    146.83f to "D3",\r\n    196.0f to "G3",\r\n    246.94f to "B3",\r\n    329.63f to "E4"\r\n)\r\n\r\nfun findNearestNote(frequency: Float, mode: TunerMode): NoteInfo {\r\n    return when (mode) {\r\n        TunerMode.GUITAR -> {\r\n            guitarNotes.minByOrNull { abs(it.first - frequency) }\r\n                ?.let { /* return info */ }\r\n                ?: pitchToNoteInfo(frequency)\r\n        }\r\n        else -> pitchToNoteInfo(frequency)\r\n    }\r\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/docs/guides/detecting-pitch",children:"Detecting Pitch Guide"})," - Pitch detection details"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/docs/concepts/pitch-detection",children:"Pitch Detection Concepts"})," - Theory"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://github.com/musicmuni/voxatrace-demos",children:"Demo App"})," - Full source"]}),"\n"]})]})}function f(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453(e,n,r){r.d(n,{R:()=>a,x:()=>s});var t=r(96540);const o={},i=t.createContext(o);function a(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);