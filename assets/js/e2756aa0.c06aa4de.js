"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[5010],{4150(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"calibra/live-eval","title":"CalibraLiveEval","description":"Real-time singing evaluation session that scores a singer\'s performance by comparing their pitch to a reference melody. Supports segment-based progression with automatic advancement, retry logic, and both singalong and singafter practice modes.","source":"@site/docs/calibra/live-eval.md","sourceDirName":"calibra","slug":"/calibra/live-eval","permalink":"/calibra/live-eval","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"CalibraVocalRange","permalink":"/calibra/vocal-range"},"next":{"title":"CalibraMelodyEval","permalink":"/calibra/melody-eval"}}');var i=s(4848),t=s(8453);const d={sidebar_position:5},l="CalibraLiveEval",c={},o=[{value:"Quick Start",id:"quick-start",level:2},{value:"Kotlin",id:"kotlin",level:3},{value:"Swift",id:"swift",level:3},{value:"When to Use",id:"when-to-use",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Presets",id:"presets",level:3},{value:"Builder",id:"builder",level:3},{value:"Kotlin",id:"kotlin-1",level:4},{value:"Swift",id:"swift-1",level:4},{value:"Config Properties",id:"config-properties",level:3},{value:"Builder Methods",id:"builder-methods",level:3},{value:"Creating a Session",id:"creating-a-session",level:2},{value:"Factory Method",id:"factory-method",level:3},{value:"Kotlin",id:"kotlin-2",level:4},{value:"Swift",id:"swift-2",level:4},{value:"Factory Parameters",id:"factory-parameters",level:3},{value:"Usage Tiers",id:"usage-tiers",level:3},{value:"Tier 1: Convenience API",id:"tier-1-convenience-api",level:4},{value:"Tier 2: Low-Level API",id:"tier-2-low-level-api",level:4},{value:"Ownership Model",id:"ownership-model",level:3},{value:"Core Features",id:"core-features",level:2},{value:"Session Lifecycle",id:"session-lifecycle",level:3},{value:"Segment Control",id:"segment-control",level:3},{value:"Navigation",id:"navigation",level:3},{value:"Feeding Audio",id:"feeding-audio",level:3},{value:"Kotlin",id:"kotlin-3",level:4},{value:"Swift",id:"swift-3",level:4},{value:"Runtime Configuration",id:"runtime-configuration",level:3},{value:"Query Methods",id:"query-methods",level:3},{value:"State Machine",id:"state-machine",level:2},{value:"SessionPhase",id:"sessionphase",level:3},{value:"PracticePhase",id:"practicephase",level:3},{value:"Observing State",id:"observing-state",level:2},{value:"Kotlin (StateFlow)",id:"kotlin-stateflow",level:3},{value:"Swift (Observers)",id:"swift-observers",level:3},{value:"StateFlows",id:"stateflows",level:3},{value:"Swift Observer Methods",id:"swift-observer-methods",level:3},{value:"Properties",id:"properties",level:3},{value:"Callbacks",id:"callbacks",level:2},{value:"Kotlin",id:"kotlin-4",level:3},{value:"Swift",id:"swift-4",level:3},{value:"Callback Reference",id:"callback-reference",level:3},{value:"Model Types",id:"model-types",level:2},{value:"SessionState",id:"sessionstate",level:3},{value:"ActiveSegmentState",id:"activesegmentstate",level:3},{value:"SegmentResult",id:"segmentresult",level:3},{value:"SingingResult",id:"singingresult",level:3},{value:"PerformanceLevel",id:"performancelevel",level:3},{value:"Segment",id:"segment",level:3},{value:"LessonMaterial",id:"lessonmaterial",level:3},{value:"Creating LessonMaterial",id:"creating-lessonmaterial",level:4},{value:"Creating Segments",id:"creating-segments",level:4},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Singalong ViewModel (Kotlin)",id:"singalong-viewmodel-kotlin",level:3},{value:"SwiftUI View Model (Swift)",id:"swiftui-view-model-swift",level:3},{value:"Low-Level Manual Audio (Kotlin)",id:"low-level-manual-audio-kotlin",level:3},{value:"Pitch Visualization (Swift)",id:"pitch-visualization-swift",level:3},{value:"Next Steps",id:"next-steps",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"calibraliveeval",children:"CalibraLiveEval"})}),"\n",(0,i.jsx)(n.p,{children:"Real-time singing evaluation session that scores a singer's performance by comparing their pitch to a reference melody. Supports segment-based progression with automatic advancement, retry logic, and both singalong and singafter practice modes."}),"\n",(0,i.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsx)(n.h3,{id:"kotlin",children:"Kotlin"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:'// 1. Create detector and session\r\nval detector = CalibraPitch.createDetector()\r\nval session = CalibraLiveEval.create(lessonMaterial, detector = detector)\r\n\r\n// 2. Prepare (loads reference, creates evaluator)\r\nsession.prepareSession()\r\n\r\n// 3. Start segment and feed audio\r\nsession.startPracticingSegment(0)\r\nrecorder.audioBuffers.collect { buffer ->\r\n    session.feedAudioSamples(buffer.toFloatArray(), sampleRate = 48000)\r\n}\r\n\r\n// 4. Get result\r\nval result = session.finishPracticingSegment()\r\nprintln("Score: ${result?.score}")\r\n\r\n// 5. Cleanup\r\nsession.closeSession()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"swift",children:"Swift"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:'// 1. Create detector and session\r\nlet detector = CalibraPitch.createDetector()\r\nlet session = CalibraLiveEval.create(\r\n    reference: lessonMaterial,\r\n    detector: detector\r\n)\r\n\r\n// 2. Prepare (loads reference, creates evaluator)\r\ntry await session.prepareSession()\r\n\r\n// 3. Start segment and feed audio\r\nsession.startPracticingSegment(index: 0)\r\nfor await buffer in recorder.audioBuffers {\r\n    session.feedAudioSamples(buffer.toFloatArray(), sampleRate: 48000)\r\n}\r\n\r\n// 4. Get result\r\nif let result = session.finishPracticingSegment() {\r\n    print("Score: \\(result.score)")\r\n}\r\n\r\n// 5. Cleanup\r\nsession.closeSession()\n'})}),"\n",(0,i.jsx)(n.h2,{id:"when-to-use",children:"When to Use"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Use This?"}),(0,i.jsx)(n.th,{children:"Why"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Score singing against reference in real time"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Core use case"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Karaoke apps with segment scoring"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Segment-based with auto-advance"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Music education with retry logic"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Practice mode with score thresholds"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Just detect pitch (no scoring)"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsxs)(n.td,{children:["Use ",(0,i.jsx)(n.code,{children:"CalibraPitch.createDetector()"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Analyze pre-recorded audio (not live)"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsxs)(n.td,{children:["Use ",(0,i.jsx)(n.code,{children:"CalibraMelodyEval"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Voice activity detection only"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsxs)(n.td,{children:["Use ",(0,i.jsx)(n.code,{children:"CalibraVAD"})]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"presets",children:"Presets"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Preset"}),(0,i.jsx)(n.th,{children:"Kotlin"}),(0,i.jsx)(n.th,{children:"Swift"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Default"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SessionConfig.DEFAULT"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:".default"})}),(0,i.jsx)(n.td,{children:"Auto-advancing, no score threshold"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Practice"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SessionConfig.PRACTICE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:".practice"})}),(0,i.jsx)(n.td,{children:"Score threshold 70%, max 3 attempts, best-of aggregation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Karaoke"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SessionConfig.KARAOKE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:".karaoke"})}),(0,i.jsx)(n.td,{children:"Always advances, one attempt per segment"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Performance"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SessionConfig.PERFORMANCE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:".performance"})}),(0,i.jsx)(n.td,{children:"One attempt, no repetition"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"builder",children:"Builder"}),"\n",(0,i.jsx)(n.h4,{id:"kotlin-1",children:"Kotlin"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"val config = SessionConfig.Builder()\r\n    .preset(SessionConfig.PRACTICE)\r\n    .scoreThreshold(0.6f)\r\n    .maxAttempts(5)\r\n    .resultAggregation(ResultAggregation.BEST)\r\n    .build()\r\n\r\nval session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,\r\n    session = config,\r\n    detector = CalibraPitch.createDetector()\r\n)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"swift-1",children:"Swift"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:"let config = SessionConfig.Builder()\r\n    .preset(.practice)\r\n    .scoreThreshold(0.6)\r\n    .maxAttempts(5)\r\n    .resultAggregation(.best)\r\n    .build()\r\n\r\nlet session = CalibraLiveEval.create(\r\n    reference: lessonMaterial,\r\n    session: config,\r\n    detector: CalibraPitch.createDetector()\r\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"config-properties",children:"Config Properties"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"autoAdvance"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"true"})}),(0,i.jsx)(n.td,{children:"Automatically advance to next segment when current ends"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"scoreThreshold"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"0"})}),(0,i.jsx)(n.td,{children:"Minimum score to auto-advance (0 = advances regardless of score)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"maxAttempts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"0"})}),(0,i.jsx)(n.td,{children:"Maximum attempts before forced advance (0 = unlimited)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"resultAggregation"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ResultAggregation"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LATEST"})}),(0,i.jsxs)(n.td,{children:["How to aggregate multiple attempts (",(0,i.jsx)(n.code,{children:"LATEST"}),", ",(0,i.jsx)(n.code,{children:"BEST"}),", ",(0,i.jsx)(n.code,{children:"AVERAGE"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hopSize"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"160"})}),(0,i.jsx)(n.td,{children:"Hop size between frames in samples (160 = 10ms at 16kHz)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"autoPhaseTransition"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"true"})}),(0,i.jsx)(n.td,{children:"Automatically transition LISTENING to SINGING in singafter mode"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"autoSegmentDetection"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"true"})}),(0,i.jsx)(n.td,{children:"Automatically detect segment end from player time"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"builder-methods",children:"Builder Methods"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"preset(config)"})}),(0,i.jsx)(n.td,{children:"Start from a preset configuration"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"autoAdvance(enabled)"})}),(0,i.jsx)(n.td,{children:"Enable or disable auto-advance to next segment"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"scoreThreshold(threshold)"})}),(0,i.jsx)(n.td,{children:"Set minimum score to auto-advance (0 = disabled)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"maxAttempts(max)"})}),(0,i.jsx)(n.td,{children:"Set maximum attempts before forced advance (0 = unlimited)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"resultAggregation(agg)"})}),(0,i.jsx)(n.td,{children:"Set how to aggregate multiple attempts"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hopSize(samples)"})}),(0,i.jsx)(n.td,{children:"Set hop size between frames in samples"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"autoPhaseTransition(enabled)"})}),(0,i.jsx)(n.td,{children:"Enable or disable automatic LISTENING to SINGING transition"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"autoSegmentDetection(enabled)"})}),(0,i.jsx)(n.td,{children:"Enable or disable automatic segment end detection"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"creating-a-session",children:"Creating a Session"}),"\n",(0,i.jsx)(n.h3,{id:"factory-method",children:"Factory Method"}),"\n",(0,i.jsx)(n.h4,{id:"kotlin-2",children:"Kotlin"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"val session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,           // LessonMaterial (required)\r\n    session = SessionConfig.PRACTICE,     // SessionConfig (default: DEFAULT)\r\n    detector = CalibraPitch.createDetector(), // Detector (required)\r\n    player = player,                      // SonixPlayer? (optional)\r\n    recorder = recorder                   // SonixRecorder? (optional)\r\n)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"swift-2",children:"Swift"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:"let session = CalibraLiveEval.create(\r\n    reference: lessonMaterial,\r\n    session: .practice,\r\n    detector: CalibraPitch.createDetector(),\r\n    player: player,\r\n    recorder: recorder\r\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"factory-parameters",children:"Factory Parameters"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"reference"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LessonMaterial"})}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Reference audio, segments, and key"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"session"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SessionConfig"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsxs)(n.td,{children:["Session configuration (default: ",(0,i.jsx)(n.code,{children:"DEFAULT"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"detector"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CalibraPitch.Detector"})}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Pitch detector. Session takes ownership and closes it."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"player"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SonixPlayer?"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Audio player for convenience API. Caller manages lifecycle."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"recorder"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SonixRecorder?"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Audio recorder for convenience API. Caller manages lifecycle."})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"usage-tiers",children:"Usage Tiers"}),"\n",(0,i.jsx)(n.h4,{id:"tier-1-convenience-api",children:"Tier 1: Convenience API"}),"\n",(0,i.jsxs)(n.p,{children:["Pass ",(0,i.jsx)(n.code,{children:"player"})," and ",(0,i.jsx)(n.code,{children:"recorder"})," handles; the session coordinates seeking, playback, recording, and scoring automatically."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"val session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,\r\n    detector = CalibraPitch.createDetector(),\r\n    player = player,\r\n    recorder = recorder\r\n)\r\nsession.prepareSession()\r\nsession.onSegmentComplete { result -> showScore(result) }\r\nsession.startPracticingSegment(0)  // Seeks, plays, records, scores automatically\n"})}),"\n",(0,i.jsx)(n.h4,{id:"tier-2-low-level-api",children:"Tier 2: Low-Level API"}),"\n",(0,i.jsxs)(n.p,{children:["Omit ",(0,i.jsx)(n.code,{children:"player"})," and ",(0,i.jsx)(n.code,{children:"recorder"}),"; manually manage audio and feed samples directly."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"val session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,\r\n    detector = CalibraPitch.createDetector()\r\n)\r\nsession.prepareSession()\r\nsession.startPracticingSegment(0)\r\nrecorder.audioBuffers.collect { buffer ->\r\n    session.feedAudioSamples(buffer.toFloatArray(), sampleRate = 48000)\r\n}\r\nval result = session.finishPracticingSegment()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"ownership-model",children:"Ownership Model"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Dependency"}),(0,i.jsx)(n.th,{children:"Ownership"}),(0,i.jsx)(n.th,{children:"Rationale"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"detector"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:"Owned"})," -- session closes it"]}),(0,i.jsx)(n.td,{children:"Created specifically for this session"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"player"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:"Borrowed"})," -- caller manages"]}),(0,i.jsx)(n.td,{children:"Shared resource, UI may need direct access"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"recorder"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:"Borrowed"})," -- caller manages"]}),(0,i.jsx)(n.td,{children:"Shared resource, may be reused"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"core-features",children:"Core Features"}),"\n",(0,i.jsx)(n.h3,{id:"session-lifecycle",children:"Session Lifecycle"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:'// Prepare (suspend, runs on background dispatcher)\r\nsession.prepareSession()\r\n\r\n// Finish and get aggregated results\r\nval result: SingingResult = session.finishSession()\r\n\r\n// Close and release all resources\r\nsession.closeSession()\r\n// Alternatively, use close() (implements AutoCloseable)\r\nsession.close()\r\n\r\n// Restart for "Practice Again"\r\nsession.restartSession(fromSegment = 0)\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:'// Prepare\r\ntry await session.prepareSession()\r\n\r\n// Finish and get aggregated results\r\nlet result = session.finishSession()\r\n\r\n// Close and release all resources\r\nsession.closeSession()\r\n\r\n// Restart for "Practice Again"\r\nsession.restartSession(fromSegment: 0)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"segment-control",children:"Segment Control"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Start practicing a specific segment\r\nsession.startPracticingSegment(0)\r\n\r\n// Finish current segment and get result\r\nval result: SegmentResult? = session.finishPracticingSegment()\r\n\r\n// Discard current segment without scoring\r\nsession.discardCurrentSegment()\r\n\r\n// Retry the same segment (increments attempt number)\r\nsession.retryCurrentSegment()\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:"session.startPracticingSegment(index: 0)\r\nlet result = session.finishPracticingSegment()\r\nsession.discardCurrentSegment()\r\nsession.retryCurrentSegment()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"navigation",children:"Navigation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Jump to a specific segment (discards current attempt if practicing)\r\nsession.seekToSegment(3)\r\n\r\n// Advance to next segment (returns false if at end)\r\nval advanced: Boolean = session.advanceToNextSegment()\r\n\r\n// Seek to a time position\r\nsession.seekToTime(seconds = 15.0f)\r\n\r\n// Pause and resume playback\r\nsession.pausePlayback()\r\nsession.resumePlayback()\r\n\r\n// Manual LISTENING \u2192 SINGING transition (when autoPhaseTransition = false)\r\nsession.beginSingingPhase()\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:"session.seekToSegment(index: 3)\r\nlet advanced = session.advanceToNextSegment()\r\nsession.seekToTime(seconds: 15.0)\r\nsession.pausePlayback()\r\nsession.resumePlayback()\r\nsession.beginSingingPhase()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"feeding-audio",children:"Feeding Audio"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"feedAudioSamples"})," method accepts audio at ",(0,i.jsx)(n.strong,{children:"any sample rate"})," and resamples internally to 16kHz. This means you do not need to pre-process audio before passing it to the session."]}),"\n",(0,i.jsx)(n.h4,{id:"kotlin-3",children:"Kotlin"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Feed from recorder (any sample rate)\r\nrecorder.audioBuffers.collect { buffer ->\r\n    session.feedAudioSamples(buffer.toFloatArray(), sampleRate = 48000)\r\n}\r\n\r\n// Default sample rate is 16000 if omitted\r\nsession.feedAudioSamples(samples)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"swift-3",children:"Swift"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:"// Feed from recorder (any sample rate)\r\nsession.feedAudioSamples(buffer, sampleRate: 48000)\r\n\r\n// Default sample rate is 16000 if omitted\r\nsession.feedAudioSamples(buffer)\n"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"samples"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"FloatArray"})," / ",(0,i.jsx)(n.code,{children:"[Float]"})]}),(0,i.jsx)(n.td,{children:"--"}),(0,i.jsx)(n.td,{children:"Mono audio samples, normalized -1.0 to 1.0"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sampleRate"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"16000"})}),(0,i.jsx)(n.td,{children:"Sample rate of the input audio in Hz"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["If the input sample rate differs from 16kHz, the session uses ",(0,i.jsx)(n.code,{children:"SonixResampler"})," to convert the audio before processing. This is handled transparently on every call."]}),"\n",(0,i.jsx)(n.h3,{id:"runtime-configuration",children:"Runtime Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Set student key for transposition (0 = same as reference)\r\nsession.setStudentKeyHz(220.0f)\r\n\r\n// Enable or disable pitch processing (smoothing + octave correction)\r\nsession.setPitchProcessingEnabled(true)\r\nval isEnabled: Boolean = session.pitchProcessingEnabled\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:"session.setStudentKeyHz(keyHz: 220.0)\r\nsession.setPitchProcessingEnabled(enabled: true)\r\nlet isEnabled = session.pitchProcessingEnabled\n"})}),"\n",(0,i.jsx)(n.h3,{id:"query-methods",children:"Query Methods"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Get all results for a specific segment\r\nval attempts: List<SegmentResult>? = session.getResultsForSegment(0)\r\n\r\n// Check if a segment has been completed at least once\r\nval completed: Boolean = session.hasCompletedSegment(0)\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:"let attempts = session.getResultsForSegment(index: 0)\r\nlet completed = session.hasCompletedSegment(index: 0)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"state-machine",children:"State Machine"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"IDLE \u2500\u2500prepareSession()\u2500\u2500\u25ba READY\r\nREADY \u2500\u2500startPracticingSegment()\u2500\u2500\u25ba PRACTICING\r\nPRACTICING \u2500\u2500finishPracticingSegment()\u2500\u2500\u25ba BETWEEN_SEGMENTS (or COMPLETED if last)\r\nPRACTICING \u2500\u2500discardCurrentSegment()\u2500\u2500\u25ba BETWEEN_SEGMENTS\r\nPRACTICING \u2500\u2500seekToSegment()\u2500\u2500\u25ba PRACTICING (new segment)\r\nBETWEEN_SEGMENTS \u2500\u2500startPracticingSegment()\u2500\u2500\u25ba PRACTICING\r\nBETWEEN_SEGMENTS \u2500\u2500advanceToNextSegment()\u2500\u2500\u25ba PRACTICING (or COMPLETED if last)\r\nBETWEEN_SEGMENTS \u2500\u2500finishSession()\u2500\u2500\u25ba COMPLETED\r\n* \u2500\u2500closeSession()\u2500\u2500\u25ba (released)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"sessionphase",children:"SessionPhase"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Phase"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"IDLE"})}),(0,i.jsx)(n.td,{children:"Session created but not started"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"READY"})}),(0,i.jsx)(n.td,{children:"Reference loaded, ready to begin practicing"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PRACTICING"})}),(0,i.jsx)(n.td,{children:"Actively capturing and evaluating audio for a segment"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"BETWEEN_SEGMENTS"})}),(0,i.jsx)(n.td,{children:"Finished one segment, waiting before next"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"COMPLETED"})}),(0,i.jsx)(n.td,{children:"All segments completed or session manually finished"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CANCELLED"})}),(0,i.jsxs)(n.td,{children:["Session was cancelled via ",(0,i.jsx)(n.code,{children:"closeSession()"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ERROR"})}),(0,i.jsx)(n.td,{children:"An error occurred during preparation"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"practicephase",children:"PracticePhase"}),"\n",(0,i.jsx)(n.p,{children:"Tracks the student's activity within a single segment. The progression depends on mode:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Singalong:"})," ",(0,i.jsx)(n.code,{children:"IDLE"})," -> ",(0,i.jsx)(n.code,{children:"SINGING"})," -> ",(0,i.jsx)(n.code,{children:"EVALUATED"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Singafter:"})," ",(0,i.jsx)(n.code,{children:"IDLE"})," -> ",(0,i.jsx)(n.code,{children:"LISTENING"})," -> ",(0,i.jsx)(n.code,{children:"SINGING"})," -> ",(0,i.jsx)(n.code,{children:"EVALUATED"})]}),"\n"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Phase"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"IDLE"})}),(0,i.jsx)(n.td,{children:"Not practicing -- waiting to start"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LISTENING"})}),(0,i.jsx)(n.td,{children:"Reference playing, student not recording yet (singafter only)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SINGING"})}),(0,i.jsx)(n.td,{children:"Student is being recorded and evaluated"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"EVALUATED"})}),(0,i.jsx)(n.td,{children:"Segment complete, score available"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"observing-state",children:"Observing State"}),"\n",(0,i.jsx)(n.h3,{id:"kotlin-stateflow",children:"Kotlin (StateFlow)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Session state (phase, active segment, pitch, progress)\r\nsession.state.collect { state ->\r\n    updateUI(state.phase, state.currentPitch, state.segmentProgress)\r\n}\r\n\r\n// Active segment details (null when not practicing)\r\nsession.activeSegment.collect { active ->\r\n    active?.let { showProgress(it.elapsedSeconds, it.remainingSeconds) }\r\n}\r\n\r\n// Completed segments map: segment index \u2192 list of attempts\r\nsession.completedSegments.collect { results ->\r\n    updateScoreboard(results)\r\n}\r\n\r\n// Practice phase (IDLE, LISTENING, SINGING, EVALUATED)\r\nsession.phase.collect { phase ->\r\n    updatePhaseIndicator(phase)\r\n}\r\n\r\n// Live pitch contour for scrolling visualization\r\nsession.livePitchContour.collect { contour ->\r\n    drawPitchCanvas(contour)\r\n}\r\n\r\n// Live pitch point (real-time, includes time and confidence)\r\nsession.livePitch.collect { pitchPoint ->\r\n    updatePitchIndicator(pitchPoint)\r\n}\r\n\r\n// Playback time, playing/recording status\r\nsession.currentTime.collect { seconds -> updateSeekBar(seconds) }\r\nsession.isPlaying.collect { playing -> updatePlayButton(playing) }\r\nsession.isRecording.collect { recording -> updateRecordingIndicator(recording) }\n"})}),"\n",(0,i.jsx)(n.h3,{id:"swift-observers",children:"Swift (Observers)"}),"\n",(0,i.jsxs)(n.p,{children:["Each observer method returns a cancellable ",(0,i.jsx)(n.code,{children:"Task"})," that dispatches updates on ",(0,i.jsx)(n.code,{children:"MainActor"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:"let stateTask = session.observeState { state in\r\n    self.sessionPhase = state.phase\r\n    self.currentPitch = state.currentPitch\r\n    self.segmentProgress = state.segmentProgress\r\n}\r\n\r\nlet activeTask = session.observeActiveSegment { active in\r\n    self.activeSegment = active\r\n}\r\n\r\nlet completedTask = session.observeCompletedSegments { results in\r\n    self.completedResults = results  // [Int: [SegmentResult]]\r\n}\r\n\r\nlet phaseTask = session.observePhase { phase in\r\n    self.practicePhase = phase\r\n}\r\n\r\nlet contourTask = session.observeLivePitchContour { contour in\r\n    self.pitchContour = contour\r\n}\r\n\r\nlet pitchTask = session.observeLivePitch { pitchPoint in\r\n    self.livePitch = pitchPoint\r\n}\r\n\r\nlet timeTask = session.observeCurrentTime { seconds in\r\n    self.currentTime = seconds\r\n}\r\n\r\nlet playingTask = session.observeIsPlaying { isPlaying in\r\n    self.isPlaying = isPlaying\r\n}\r\n\r\nlet recordingTask = session.observeIsRecording { isRecording in\r\n    self.isRecording = isRecording\r\n}\r\n\r\n// Cancel when done\r\nstateTask.cancel()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"stateflows",children:"StateFlows"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"StateFlow"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"state"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"StateFlow<SessionState>"})}),(0,i.jsx)(n.td,{children:"Session state (phase, pitch, amplitude, progress, completed segments)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"activeSegment"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"StateFlow<ActiveSegmentState?>"})}),(0,i.jsx)(n.td,{children:"Active segment details, or null if not practicing"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"completedSegments"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"StateFlow<Map<Int, List<SegmentResult>>>"})}),(0,i.jsx)(n.td,{children:"Map of segment index to list of attempts"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"phase"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"StateFlow<PracticePhase>"})}),(0,i.jsx)(n.td,{children:"Current practice phase (IDLE, LISTENING, SINGING, EVALUATED)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"livePitchContour"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"StateFlow<PitchContour>"})}),(0,i.jsx)(n.td,{children:"Accumulated pitch contour for scrolling visualization"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"livePitch"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"StateFlow<PitchPoint>"})}),(0,i.jsx)(n.td,{children:"Real-time pitch point (includes time and confidence)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"currentTime"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"StateFlow<Float>"})}),(0,i.jsx)(n.td,{children:"Playback position in seconds"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"isPlaying"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"StateFlow<Boolean>"})}),(0,i.jsx)(n.td,{children:"Whether player is currently playing"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"isRecording"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"StateFlow<Boolean>"})}),(0,i.jsx)(n.td,{children:"Whether recording is active"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"swift-observer-methods",children:"Swift Observer Methods"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Callback Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"observeState(_:)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(SessionState) -> Void"})}),(0,i.jsx)(n.td,{children:"Session state changes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"observeActiveSegment(_:)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(ActiveSegmentState?) -> Void"})}),(0,i.jsx)(n.td,{children:"Active segment changes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"observeCompletedSegments(_:)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"([Int: [SegmentResult]]) -> Void"})}),(0,i.jsxs)(n.td,{children:["Completed segments with native Swift ",(0,i.jsx)(n.code,{children:"Int"})," keys"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"observePhase(_:)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(PracticePhase) -> Void"})}),(0,i.jsx)(n.td,{children:"Practice phase changes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"observeLivePitchContour(_:)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(PitchContour) -> Void"})}),(0,i.jsx)(n.td,{children:"Live pitch contour updates"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"observeLivePitch(_:)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(PitchPoint) -> Void"})}),(0,i.jsx)(n.td,{children:"Real-time pitch point updates"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"observeCurrentTime(_:)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(Float) -> Void"})}),(0,i.jsx)(n.td,{children:"Playback time updates"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"observeIsPlaying(_:)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(Bool) -> Void"})}),(0,i.jsx)(n.td,{children:"Playing state changes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"observeIsRecording(_:)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(Bool) -> Void"})}),(0,i.jsx)(n.td,{children:"Recording state changes"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"properties",children:"Properties"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"segments"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"List<Segment>"})}),(0,i.jsx)(n.td,{children:"All segments from the reference"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"referenceKeyHz"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Reference key in Hz from LessonMaterial"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"studentKeyHz"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Current student key in Hz (0 = same as reference)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"pitchProcessingEnabled"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:"Whether pitch processing is currently enabled"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"callbacks",children:"Callbacks"}),"\n",(0,i.jsxs)(n.p,{children:["Alternative to StateFlow observation. Callbacks are dispatched on ",(0,i.jsx)(n.code,{children:"MainActor"})," in Swift."]}),"\n",(0,i.jsx)(n.h3,{id:"kotlin-4",children:"Kotlin"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:'session.onPhaseChanged { phase ->\r\n    println("Phase: $phase")\r\n}\r\n\r\nsession.onReferenceEnd { segment ->\r\n    println("Reference ended for: ${segment.lyrics}")\r\n}\r\n\r\nsession.onSegmentComplete { result ->\r\n    println("Score: ${result.score}")\r\n}\r\n\r\nsession.onSessionComplete { result ->\r\n    println("Overall: ${result.overallScore}")\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"swift-4",children:"Swift"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:'session.onPhaseChanged { phase in\r\n    print("Phase: \\(phase)")\r\n}\r\n\r\nsession.onReferenceEnd { segment in\r\n    print("Reference ended for: \\(segment.lyrics)")\r\n}\r\n\r\nsession.onSegmentComplete { result in\r\n    print("Score: \\(result.score)")\r\n}\r\n\r\nsession.onSessionComplete { result in\r\n    print("Overall: \\(result.overallScore)")\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"callback-reference",children:"Callback Reference"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Callback Signature"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"onPhaseChanged"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(PracticePhase) -> Unit"})}),(0,i.jsx)(n.td,{children:"Practice phase transitions (e.g., LISTENING to SINGING)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"onReferenceEnd"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(Segment) -> Unit"})}),(0,i.jsx)(n.td,{children:"Reference audio finished playing (singafter mode)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"onSegmentComplete"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(SegmentResult) -> Unit"})}),(0,i.jsx)(n.td,{children:"Segment finished with its result"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"onSessionComplete"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(SingingResult) -> Unit"})}),(0,i.jsx)(n.td,{children:"All segments finished"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"model-types",children:"Model Types"}),"\n",(0,i.jsx)(n.h3,{id:"sessionstate",children:"SessionState"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"phase"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SessionPhase"})}),(0,i.jsx)(n.td,{children:"Current session phase"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"activeSegmentIndex"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int?"})}),(0,i.jsx)(n.td,{children:"Index of segment being practiced, or null"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"activeSegment"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Segment?"})}),(0,i.jsx)(n.td,{children:"The segment being practiced, or null"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"currentPitch"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Detected pitch in Hz (-1 for unvoiced)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"currentAmplitude"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Audio amplitude (0.0 - 1.0)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"segmentProgress"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Progress through current segment (0.0 - 1.0)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"completedSegments"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Set<Int>"})}),(0,i.jsx)(n.td,{children:"Indices of completed segments"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"error"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String?"})}),(0,i.jsx)(n.td,{children:"Error message if phase is ERROR"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"isPracticing"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:"True if session is actively practicing"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"canBeginSegment"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:"True if a new segment can be started"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"isFinished"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:"True if session is finished (COMPLETED, CANCELLED, or ERROR)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"completedCount"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int"})}),(0,i.jsx)(n.td,{children:"Number of completed segments"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"activesegmentstate",children:"ActiveSegmentState"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"segmentIndex"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int"})}),(0,i.jsx)(n.td,{children:"Index of the segment"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"segment"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Segment"})}),(0,i.jsx)(n.td,{children:"The segment being practiced"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"currentPitch"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Detected pitch in Hz (-1 for unvoiced)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"currentAmplitude"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Audio amplitude (0.0 - 1.0)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"elapsedSeconds"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Time elapsed since segment started"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"isCapturing"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:"Whether audio is currently being captured"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"progress"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Progress through the segment (0.0 - 1.0)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"remainingSeconds"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Time remaining in seconds"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hasVoice"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:"True if detected pitch is valid"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"segmentresult",children:"SegmentResult"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"segment"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Segment"})}),(0,i.jsx)(n.td,{children:"The segment that was evaluated"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"score"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Overall score (0.0 - 1.0)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"pitchAccuracy"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Pitch accuracy component (0.0 - 1.0)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"level"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PerformanceLevel"})}),(0,i.jsx)(n.td,{children:"Performance level classification"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"attemptNumber"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int"})}),(0,i.jsx)(n.td,{children:"Which attempt this is (1-based)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"referencePitch"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PitchContour"})}),(0,i.jsx)(n.td,{children:"Reference pitch contour for visualization"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"studentPitch"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PitchContour"})}),(0,i.jsx)(n.td,{children:"Student pitch contour for visualization"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"isPassing"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:"True if score >= 0.5"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"isGood"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:"True if score >= 0.7"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"isExcellent"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:"True if score >= 0.9"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"scorePercent"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int"})}),(0,i.jsx)(n.td,{children:"Score as percentage (0-100)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"feedbackMessage"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String"})}),(0,i.jsx)(n.td,{children:"Human-readable feedback based on performance level"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"singingresult",children:"SingingResult"}),"\n",(0,i.jsxs)(n.p,{children:["Returned by ",(0,i.jsx)(n.code,{children:"finishSession()"})," with aggregated results across all segments."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"overallScore"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Aggregate score across all segments (0.0 - 1.0)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"segmentResults"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Map<Int, List<SegmentResult>>"})}),(0,i.jsx)(n.td,{children:"Map of segment index to list of attempts"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"aggregation"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ResultAggregation"})}),(0,i.jsx)(n.td,{children:"How the overall score was calculated"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"overallScorePercent"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int"})}),(0,i.jsx)(n.td,{children:"Overall score as percentage (0-100)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"segmentCount"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int"})}),(0,i.jsx)(n.td,{children:"Number of segments evaluated"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"totalAttempts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int"})}),(0,i.jsx)(n.td,{children:"Total attempts across all segments"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"allPassing"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:"True if all segments have a passing score"})]})]})]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"latestScorePerSegment()"})}),(0,i.jsx)(n.td,{children:"Latest score for each segment"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bestScorePerSegment()"})}),(0,i.jsx)(n.td,{children:"Best score for each segment"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"averageScorePerSegment()"})}),(0,i.jsx)(n.td,{children:"Average score for each segment"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"latestResultPerSegment()"})}),(0,i.jsxs)(n.td,{children:["Latest ",(0,i.jsx)(n.code,{children:"SegmentResult"})," for each segment"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getAllFeedback()"})}),(0,i.jsx)(n.td,{children:"Feedback messages for all segments"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"performancelevel",children:"PerformanceLevel"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Level"}),(0,i.jsx)(n.th,{children:"Score Range"}),(0,i.jsx)(n.th,{children:"Display Name"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NEEDS_WORK"})}),(0,i.jsx)(n.td,{children:"< 0.3"}),(0,i.jsx)(n.td,{children:'"Needs Work"'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"FAIR"})}),(0,i.jsx)(n.td,{children:"0.3 - 0.6"}),(0,i.jsx)(n.td,{children:'"Fair"'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GOOD"})}),(0,i.jsx)(n.td,{children:"0.6 - 0.8"}),(0,i.jsx)(n.td,{children:'"Good"'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"VERY_GOOD"})}),(0,i.jsx)(n.td,{children:"0.8 - 0.95"}),(0,i.jsx)(n.td,{children:'"Very Good"'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"EXCELLENT"})}),(0,i.jsx)(n.td,{children:">= 0.95"}),(0,i.jsx)(n.td,{children:'"Excellent"'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NOT_DETECTED"})}),(0,i.jsx)(n.td,{children:"negative"}),(0,i.jsx)(n.td,{children:'"No Voice"'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NOT_EVALUATED"})}),(0,i.jsx)(n.td,{children:"--"}),(0,i.jsx)(n.td,{children:'"Not Evaluated"'})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"segment",children:"Segment"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"index"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int"})}),(0,i.jsx)(n.td,{children:"Zero-based segment index"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"startSeconds"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Reference audio start time"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"endSeconds"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Reference audio end time"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"lyrics"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String"})}),(0,i.jsx)(n.td,{children:"Text/lyrics for this segment (optional)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"studentStartSeconds"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float?"})}),(0,i.jsxs)(n.td,{children:["When student recording starts (null = same as ",(0,i.jsx)(n.code,{children:"startSeconds"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"studentEndSeconds"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float?"})}),(0,i.jsxs)(n.td,{children:["When student recording ends (null = same as ",(0,i.jsx)(n.code,{children:"endSeconds"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"duration"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Duration in seconds"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"isSingafter"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Boolean"})}),(0,i.jsx)(n.td,{children:"True if student starts after reference"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"effectiveStudentStart"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsxs)(n.td,{children:["Student start time (falls back to ",(0,i.jsx)(n.code,{children:"startSeconds"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"effectiveStudentEnd"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsxs)(n.td,{children:["Student end time (falls back to ",(0,i.jsx)(n.code,{children:"endSeconds"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"studentDuration"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Duration of the student recording portion"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"lessonmaterial",children:"LessonMaterial"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"audioSource"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"AudioSource"})}),(0,i.jsx)(n.td,{children:"Source of the reference audio"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"segments"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"List<Segment>"})}),(0,i.jsx)(n.td,{children:"Segment boundaries and lyrics"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"keyHz"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Musical key frequency in Hz (e.g., 261.63 for middle C)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"pitchContour"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PitchContour?"})}),(0,i.jsx)(n.td,{children:"Pre-computed pitch (enables fast initialization)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"hpcpFrames"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"List<FloatArray>?"})}),(0,i.jsx)(n.td,{children:"Pre-computed HPCP frames for DTW alignment"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"duration"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Float"})}),(0,i.jsx)(n.td,{children:"Total duration based on the last segment's end time"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"segmentCount"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Int"})}),(0,i.jsx)(n.td,{children:"Number of segments"})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"creating-lessonmaterial",children:"Creating LessonMaterial"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:'// From audio file\r\nval material = LessonMaterial.fromFile(\r\n    audioPath = "/path/to/reference.m4a",\r\n    segments = segments,\r\n    keyHz = 196.0f\r\n)\r\n\r\n// From raw audio samples (with optional pre-computed pitch)\r\nval material = LessonMaterial.fromAudio(\r\n    samples = audioData.samples,\r\n    sampleRate = audioData.sampleRate,\r\n    segments = segments,\r\n    keyHz = 196.0f,\r\n    pitchContour = preComputedContour  // optional, speeds up prepareSession()\r\n)\n'})}),"\n",(0,i.jsx)(n.h4,{id:"creating-segments",children:"Creating Segments"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:'// Individual segments\r\nval segments = listOf(\r\n    Segment(index = 0, startSeconds = 0.0f, endSeconds = 4.5f, lyrics = "Sa Re Ga Ma"),\r\n    Segment(index = 1, startSeconds = 4.5f, endSeconds = 9.0f, lyrics = "Pa Da Ni Sa")\r\n)\r\n\r\n// From parallel arrays\r\nval segments = Segment.fromArrays(\r\n    starts = floatArrayOf(0.0f, 4.5f, 9.0f),\r\n    ends = floatArrayOf(4.5f, 9.0f, 13.5f),\r\n    lyrics = listOf("Sa Re Ga Ma", "Pa Da Ni Sa", "Sa Ni Da Pa")\r\n)\r\n\r\n// Singafter segments (student sings after reference)\r\nval segments = Segment.fromArrays(\r\n    starts = floatArrayOf(0.0f, 8.0f),\r\n    ends = floatArrayOf(8.0f, 16.0f),\r\n    studentStarts = floatArrayOf(4.0f, 12.0f),  // Student starts halfway\r\n    studentEnds = floatArrayOf(8.0f, 16.0f)\r\n)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"singalong-viewmodel-kotlin",children:"Singalong ViewModel (Kotlin)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"class SingalongViewModel : ViewModel() {\r\n    private var session: CalibraLiveEval? = null\r\n    private var player: SonixPlayer? = null\r\n    private var recorder: SonixRecorder? = null\r\n\r\n    val practicePhase = MutableStateFlow(PracticePhase.IDLE)\r\n    val currentPitch = MutableStateFlow(-1f)\r\n    val lastResult = MutableStateFlow<SegmentResult?>(null)\r\n\r\n    fun loadSession(reference: LessonMaterial, config: SessionConfig) {\r\n        viewModelScope.launch {\r\n            player = SonixPlayer.create(audioPath, SonixPlayerConfig.DEFAULT)\r\n            recorder = SonixRecorder.create(tempPath, SonixRecorderConfig.VOICE)\r\n\r\n            session = CalibraLiveEval.create(\r\n                reference = reference,\r\n                session = config,\r\n                detector = CalibraPitch.createDetector(),\r\n                player = player,\r\n                recorder = recorder\r\n            )\r\n\r\n            session?.onPhaseChanged { phase -> practicePhase.value = phase }\r\n            session?.onSegmentComplete { result -> lastResult.value = result }\r\n\r\n            session?.prepareSession()\r\n\r\n            // Observe session state\r\n            session?.state?.collect { state ->\r\n                currentPitch.value = state.currentPitch\r\n            }\r\n        }\r\n    }\r\n\r\n    fun play(segmentIndex: Int) {\r\n        session?.startPracticingSegment(segmentIndex)\r\n    }\r\n\r\n    fun pause() {\r\n        session?.pausePlayback()\r\n    }\r\n\r\n    fun seekTo(segmentIndex: Int) {\r\n        session?.seekToSegment(segmentIndex)\r\n    }\r\n\r\n    fun retry() {\r\n        session?.retryCurrentSegment()\r\n    }\r\n\r\n    fun finish(): SingingResult? {\r\n        return session?.finishSession()\r\n    }\r\n\r\n    override fun onCleared() {\r\n        session?.close()\r\n        player?.release()\r\n        recorder?.release()\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"swiftui-view-model-swift",children:"SwiftUI View Model (Swift)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:"@MainActor\r\nclass SingalongViewModel: ObservableObject {\r\n    @Published var phase: PracticePhase = .idle\r\n    @Published var lastResult: SegmentResult?\r\n    @Published var currentPitch: Float = -1\r\n\r\n    private var session: CalibraLiveEval?\r\n    private var observerTasks: [Task<Void, Never>] = []\r\n\r\n    func loadSession(reference: LessonMaterial) async {\r\n        let detector = CalibraPitch.createDetector()\r\n        let session = CalibraLiveEval.create(\r\n            reference: reference,\r\n            session: .practice,\r\n            detector: detector,\r\n            player: player,\r\n            recorder: recorder\r\n        )\r\n        self.session = session\r\n\r\n        session.onPhaseChanged { [weak self] phase in\r\n            self?.phase = phase\r\n        }\r\n        session.onSegmentComplete { [weak self] result in\r\n            self?.lastResult = result\r\n        }\r\n\r\n        try? await session.prepareSession()\r\n\r\n        observerTasks.append(session.observeState { [weak self] state in\r\n            self?.currentPitch = state.currentPitch\r\n        })\r\n    }\r\n\r\n    func play(segmentIndex: Int) {\r\n        session?.startPracticingSegment(index: segmentIndex)\r\n    }\r\n\r\n    func pause() {\r\n        session?.pausePlayback()\r\n    }\r\n\r\n    func seekTo(segmentIndex: Int) {\r\n        session?.seekToSegment(index: segmentIndex)\r\n    }\r\n\r\n    func cleanup() {\r\n        observerTasks.forEach { $0.cancel() }\r\n        session?.closeSession()\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"low-level-manual-audio-kotlin",children:"Low-Level Manual Audio (Kotlin)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:'val session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,\r\n    detector = CalibraPitch.createDetector()\r\n)\r\nsession.prepareSession()\r\n\r\nfor (segmentIndex in session.segments.indices) {\r\n    session.startPracticingSegment(segmentIndex)\r\n\r\n    // Feed audio from your own source\r\n    recorder.audioBuffers.collect { buffer ->\r\n        session.feedAudioSamples(buffer.toFloatArray(), sampleRate = 48000)\r\n    }\r\n\r\n    val result = session.finishPracticingSegment()\r\n    println("Segment $segmentIndex: ${result?.scorePercent}%")\r\n}\r\n\r\nval finalResult = session.finishSession()\r\nprintln("Overall: ${finalResult.overallScorePercent}%")\r\nsession.closeSession()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"pitch-visualization-swift",children:"Pitch Visualization (Swift)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:'let contourTask = session.observeLivePitchContour { contour in\r\n    let anchorX: CGFloat = 200  // "Now" position on screen\r\n    let currentTime = contour.samples.last?.timeSeconds ?? 0\r\n\r\n    for sample in contour.samples {\r\n        let x = anchorX - CGFloat(currentTime - sample.timeSeconds) * pixelsPerSecond\r\n        let y = midiToScreenY(sample.midiNote)\r\n        drawPoint(x, y)\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./pitch",children:"CalibraPitch"})," -- Pitch detection without scoring"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./vad",children:"CalibraVAD"})," -- Voice activity detection"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./vocal-range",children:"CalibraVocalRange"})," -- Detect a singer's vocal range"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>d,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function d(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);