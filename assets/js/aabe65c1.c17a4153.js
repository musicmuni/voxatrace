"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[325],{1608(e,n,r){r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"guides/live-evaluation","title":"Live Evaluation","description":"A complete guide to real-time singing evaluation with CalibraLiveEval.","source":"@site/docs/guides/live-evaluation.md","sourceDirName":"guides","slug":"/guides/live-evaluation","permalink":"/voxatrace/guides/live-evaluation","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"Detecting Pitch","permalink":"/voxatrace/guides/detecting-pitch"},"next":{"title":"Karaoke App","permalink":"/voxatrace/cookbook/karaoke-app"}}');var i=r(4848),t=r(8453);const l={sidebar_position:4},a="Live Evaluation",o={},c=[{value:"What You&#39;ll Learn",id:"what-youll-learn",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Kotlin",id:"kotlin",level:3},{value:"Swift",id:"swift",level:3},{value:"Low-Level vs Convenience API",id:"low-level-vs-convenience-api",level:2},{value:"Low-Level API",id:"low-level-api",level:3},{value:"Convenience API",id:"convenience-api",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Auto-Advance",id:"auto-advance",level:3},{value:"Score Threshold",id:"score-threshold",level:3},{value:"Key Transposition",id:"key-transposition",level:3},{value:"Observing State",id:"observing-state",level:2},{value:"Segment Control",id:"segment-control",level:2},{value:"Working with Results",id:"working-with-results",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"live-evaluation",children:"Live Evaluation"})}),"\n",(0,i.jsx)(n.p,{children:"A complete guide to real-time singing evaluation with CalibraLiveEval."}),"\n",(0,i.jsx)(n.h2,{id:"what-youll-learn",children:"What You'll Learn"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Score singing against a reference melody in real-time"}),"\n",(0,i.jsx)(n.li,{children:"Configure singalong and singafter modes"}),"\n",(0,i.jsx)(n.li,{children:"Handle segment-based practice with auto-advance"}),"\n",(0,i.jsx)(n.li,{children:"Display pitch visualization with reference comparison"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"VoxaTrace installed"}),"\n",(0,i.jsx)(n.li,{children:"Reference audio with segment annotations (LessonMaterial)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsx)(n.h3,{id:"kotlin",children:"Kotlin"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:'// 1. Create detector and session\r\nval detector = CalibraPitch.createDetector()\r\nval session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,\r\n    detector = detector\r\n)\r\n\r\n// 2. Prepare (loads reference features)\r\nsession.prepare()\r\n\r\n// 3. Start segment\r\nsession.beginSegment(0)\r\n\r\n// 4. Feed audio\r\nrecorder.audioBuffers.collect { buffer ->\r\n    session.addAudio(buffer.toFloatArray(), buffer.sampleRate)\r\n}\r\n\r\n// 5. Get result\r\nval result = session.endSegmentEarly()\r\nprintln("Score: ${result?.score}")\r\n\r\n// 6. Cleanup\r\nsession.close()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"swift",children:"Swift"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:'// 1. Create detector and session\r\nlet detector = CalibraPitch.companion.createDetector()\r\nlet session = CalibraLiveEval.companion.create(\r\n    reference: lessonMaterial,\r\n    detector: detector\r\n)\r\n\r\n// 2. Prepare\r\ntry await session.prepare()\r\n\r\n// 3. Start segment\r\nsession.beginSegment(index: 0)\r\n\r\n// 4. Feed audio\r\nfor await buffer in recorder.audioBuffersStream() {\r\n    session.addAudio(samples: buffer.toFloatArray(), sampleRate: buffer.sampleRate)\r\n}\r\n\r\n// 5. Get result\r\nif let result = session.endSegmentEarly() {\r\n    print("Score: \\(result.score)")\r\n}\r\n\r\n// 6. Cleanup\r\nsession.close()\n'})}),"\n",(0,i.jsx)(n.h2,{id:"low-level-vs-convenience-api",children:"Low-Level vs Convenience API"}),"\n",(0,i.jsx)(n.h3,{id:"low-level-api",children:"Low-Level API"}),"\n",(0,i.jsx)(n.p,{children:"Full control over audio flow:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"val session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,\r\n    detector = detector\r\n)\r\n\r\nsession.prepare()\r\nsession.beginSegment(0)\r\n\r\n// You manage recorder\r\nrecorder.start()\r\nrecorder.audioBuffers.collect { buffer ->\r\n    session.addAudio(buffer.toFloatArray(), buffer.sampleRate)\r\n}\r\nrecorder.stop()\r\n\r\nval result = session.endSegmentEarly()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"convenience-api",children:"Convenience API"}),"\n",(0,i.jsx)(n.p,{children:"Library coordinates playback and recording:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"val session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,\r\n    detector = detector,\r\n    player = player,      // Library controls\r\n    recorder = recorder   // Library controls\r\n)\r\n\r\nsession.prepare()\r\n\r\n// Register callbacks\r\nsession.onSegmentComplete { result ->\r\n    showScore(result)\r\n}\r\n\r\n// Single call handles everything\r\nsession.playSegment(0)  // Seeks, plays, records, scores\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"auto-advance",children:"Auto-Advance"}),"\n",(0,i.jsx)(n.p,{children:"Automatically move to next segment:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"val session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,\r\n    session = SessionConfig.Builder()\r\n        .autoAdvance(true)\r\n        .build(),\r\n    detector = detector\r\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"score-threshold",children:"Score Threshold"}),"\n",(0,i.jsx)(n.p,{children:"Require minimum score before advancing:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"val session = CalibraLiveEval.create(\r\n    reference = lessonMaterial,\r\n    session = SessionConfig.Builder()\r\n        .scoreThreshold(0.7f)   // Must score 70%\r\n        .maxAttempts(3)         // Up to 3 retries\r\n        .autoAdvance(true)\r\n        .build(),\r\n    detector = detector\r\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"key-transposition",children:"Key Transposition"}),"\n",(0,i.jsx)(n.p,{children:"When student sings in a different key:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"session.setStudentKeyHz(referenceKeyHz * 0.89f)  // 2 semitones down\n"})}),"\n",(0,i.jsx)(n.h2,{id:"observing-state",children:"Observing State"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Session state\r\nsession.state.collect { state ->\r\n    when (state.phase) {\r\n        SessionPhase.IDLE -> showIdleUI()\r\n        SessionPhase.READY -> showReadyUI()\r\n        SessionPhase.PRACTICING -> {\r\n            updateProgress(state.segmentProgress)\r\n            showPitch(state.currentPitch)\r\n        }\r\n        SessionPhase.BETWEEN_SEGMENTS -> showScoreUI()\r\n        SessionPhase.COMPLETED -> showCompletionUI()\r\n    }\r\n}\r\n\r\n// Practice phase (singalong/singafter)\r\nsession.phase.collect { phase ->\r\n    when (phase) {\r\n        PracticePhase.LISTENING -> showListeningIndicator()\r\n        PracticePhase.SINGING -> showSingingIndicator()\r\n        PracticePhase.EVALUATED -> hideIndicators()\r\n    }\r\n}\r\n\r\n// Live pitch for visualization\r\nsession.livePitchContour.collect { contour ->\r\n    drawPitchCurve(contour)\r\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"segment-control",children:"Segment Control"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"// Jump to specific segment\r\nsession.beginSegment(2)\r\n\r\n// Retry current segment\r\nsession.retrySegment()\r\n\r\n// Cancel without scoring\r\nsession.cancelSegment()\r\n\r\n// End early and get result\r\nval result = session.endSegmentEarly()\r\n\r\n// Navigate between segments\r\nsegmentButtons.forEachIndexed { index, button ->\r\n    button.onClick { session.beginSegment(index) }\r\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"working-with-results",children:"Working with Results"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:'session.onSegmentComplete { result ->\r\n    // Show score\r\n    scoreLabel.text = "${(result.score * 100).toInt()}%"\r\n\r\n    // Show performance level\r\n    levelLabel.text = result.level.name  // POOR, FAIR, GOOD, GREAT, PERFECT\r\n\r\n    // Draw pitch comparison\r\n    drawPitchComparison(\r\n        reference = result.referencePitch,\r\n        student = result.studentPitch\r\n    )\r\n\r\n    // Handle based on score\r\n    when {\r\n        result.score >= 0.9f -> showCelebration()\r\n        result.score >= 0.7f -> showEncouragement()\r\n        else -> offerRetry()\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",children:"class PracticeViewModel : ViewModel() {\r\n    private var session: CalibraLiveEval? = null\r\n\r\n    val state = MutableStateFlow<SessionState?>(null)\r\n    val currentResult = MutableStateFlow<SegmentResult?>(null)\r\n\r\n    suspend fun startSession(lesson: LessonMaterial, player: SonixPlayer, recorder: SonixRecorder) {\r\n        val detector = CalibraPitch.createDetector()\r\n\r\n        session = CalibraLiveEval.create(\r\n            reference = lesson,\r\n            session = SessionConfig.Builder()\r\n                .preset(SessionConfig.PRACTICE)\r\n                .autoAdvance(true)\r\n                .scoreThreshold(0.6f)\r\n                .build(),\r\n            detector = detector,\r\n            player = player,\r\n            recorder = recorder\r\n        )\r\n\r\n        session?.prepare()\r\n\r\n        // Observe state\r\n        viewModelScope.launch {\r\n            session?.state?.collect { state.value = it }\r\n        }\r\n\r\n        // Handle segment completion\r\n        session?.onSegmentComplete { result ->\r\n            currentResult.value = result\r\n        }\r\n\r\n        // Handle session completion\r\n        session?.onSessionComplete { result ->\r\n            showFinalScore(result.overallScore)\r\n        }\r\n    }\r\n\r\n    fun playSegment(index: Int) {\r\n        session?.playSegment(index)\r\n    }\r\n\r\n    fun retrySegment() {\r\n        session?.retrySegment()\r\n    }\r\n\r\n    fun cleanup() {\r\n        session?.close()\r\n        session = null\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/api/calibra/CalibraLiveEval",children:"CalibraLiveEval API Reference"})," - Full API documentation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/concepts/live-evaluation",children:"Live Evaluation Concepts"})," - Theory and background"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/cookbook/karaoke-app",children:"Karaoke App Recipe"})," - Complete example"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>l,x:()=>a});var s=r(6540);const i={},t=s.createContext(i);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);