"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[648],{3910(e,r,n){n.r(r),n.d(r,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"cookbook/karaoke-app","title":"Karaoke App","description":"Build a karaoke app that plays backing tracks and scores singing in real-time.","source":"@site/docs/cookbook/karaoke-app.md","sourceDirName":"cookbook","slug":"/cookbook/karaoke-app","permalink":"/voxatrace/cookbook/karaoke-app","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Live Evaluation","permalink":"/voxatrace/guides/live-evaluation"},"next":{"title":"Tuner App","permalink":"/voxatrace/cookbook/tuner-app"}}');var t=n(4848),i=n(8453);const o={sidebar_position:1},l="Karaoke App",s={},c=[{value:"What You&#39;ll Build",id:"what-youll-build",level:2},{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Data Models",id:"data-models",level:3},{value:"ViewModel",id:"viewmodel",level:3},{value:"UI (Compose)",id:"ui-compose",level:3},{value:"Swift (SwiftUI)",id:"swift-swiftui",level:3},{value:"Key Features",id:"key-features",level:2},{value:"Echo Cancellation",id:"echo-cancellation",level:3},{value:"Key Transposition",id:"key-transposition",level:3},{value:"Practice Mode",id:"practice-mode",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"karaoke-app",children:"Karaoke App"})}),"\n",(0,t.jsx)(r.p,{children:"Build a karaoke app that plays backing tracks and scores singing in real-time."}),"\n",(0,t.jsx)(r.h2,{id:"what-youll-build",children:"What You'll Build"}),"\n",(0,t.jsx)(r.p,{children:"A complete karaoke experience:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Play backing track with pitch/tempo control"}),"\n",(0,t.jsx)(r.li,{children:"Record vocals with echo cancellation"}),"\n",(0,t.jsx)(r.li,{children:"Show live pitch visualization"}),"\n",(0,t.jsx)(r.li,{children:"Score singing per segment"}),"\n",(0,t.jsx)(r.li,{children:"Track best scores"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502                     KaraokeViewModel                     \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502  SonixPlayer          SonixRecorder     CalibraLiveEval \u2502\r\n\u2502  (backing track)      (vocals)          (scoring)       \u2502\r\n\u2502       \u2193                    \u2193                  \u2191         \u2502\r\n\u2502  Pitch/Tempo          Echo Cancel       Pitch Compare   \u2502\r\n\u2502  Control              Audio Buffers \u2192   with Reference  \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(r.h2,{id:"implementation",children:"Implementation"}),"\n",(0,t.jsx)(r.h3,{id:"data-models",children:"Data Models"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-kotlin",children:"data class KaraokeSong(\r\n    val id: String,\r\n    val title: String,\r\n    val artist: String,\r\n    val backingTrackPath: String,\r\n    val vocalGuidePath: String?,  // Optional guide vocals\r\n    val lessonMaterial: LessonMaterial  // Segments + reference audio\r\n)\r\n\r\ndata class KaraokeState(\r\n    val phase: KaraokePhase,\r\n    val currentSegment: Int,\r\n    val segmentProgress: Float,\r\n    val currentPitch: Float,\r\n    val currentScore: Float?,\r\n    val overallScore: Float\r\n)\r\n\r\nenum class KaraokePhase {\r\n    LOADING, READY, SINGING, BETWEEN_SEGMENTS, FINISHED\r\n}\n"})}),"\n",(0,t.jsx)(r.h3,{id:"viewmodel",children:"ViewModel"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-kotlin",children:"class KaraokeViewModel : ViewModel() {\r\n    private var player: SonixPlayer? = null\r\n    private var recorder: SonixRecorder? = null\r\n    private var session: CalibraLiveEval? = null\r\n\r\n    private val _state = MutableStateFlow(KaraokeState(...))\r\n    val state: StateFlow<KaraokeState> = _state.asStateFlow()\r\n\r\n    val livePitch: StateFlow<PitchContour>\r\n        get() = session?.livePitchContour ?: MutableStateFlow(PitchContour.EMPTY)\r\n\r\n    // Settings\r\n    var pitchShift: Float = 0f\r\n        set(value) {\r\n            field = value\r\n            player?.pitch = value\r\n        }\r\n\r\n    var tempoFactor: Float = 1f\r\n        set(value) {\r\n            field = value\r\n            player?.tempo = value\r\n        }\r\n\r\n    suspend fun loadSong(song: KaraokeSong) {\r\n        _state.update { it.copy(phase = KaraokePhase.LOADING) }\r\n\r\n        // Create player for backing track\r\n        player = SonixPlayer.create(\r\n            song.backingTrackPath,\r\n            SonixPlayerConfig.Builder()\r\n                .onComplete { handleSongEnd() }\r\n                .build()\r\n        )\r\n\r\n        // Create recorder with echo cancellation\r\n        recorder = SonixRecorder.createTemporary(\r\n            SonixRecorderConfig.Builder()\r\n                .echoCancellation(true)\r\n                .playbackSyncProvider(player!!.asPlaybackInfoProvider)\r\n                .build()\r\n        )\r\n\r\n        // Create pitch detector\r\n        val detector = CalibraPitch.createDetector(\r\n            PitchDetectorConfig.Builder()\r\n                .algorithm(PitchAlgorithm.SWIFT_F0)\r\n                .enableProcessing()\r\n                .build(),\r\n            modelProvider = { ModelLoader.loadSwiftF0() }\r\n        )\r\n\r\n        // Create evaluation session\r\n        session = CalibraLiveEval.create(\r\n            reference = song.lessonMaterial,\r\n            session = SessionConfig.Builder()\r\n                .autoAdvance(true)\r\n                .build(),\r\n            detector = detector,\r\n            player = player,\r\n            recorder = recorder\r\n        )\r\n\r\n        session?.prepareSession()\r\n\r\n        // Wire up callbacks\r\n        session?.onSegmentComplete { result ->\r\n            _state.update { it.copy(currentScore = result.score) }\r\n        }\r\n\r\n        session?.onSessionComplete { result ->\r\n            _state.update {\r\n                it.copy(\r\n                    phase = KaraokePhase.FINISHED,\r\n                    overallScore = result.overallScore\r\n                )\r\n            }\r\n        }\r\n\r\n        // Observe state\r\n        viewModelScope.launch {\r\n            session?.state?.collect { sessionState ->\r\n                _state.update {\r\n                    it.copy(\r\n                        phase = when (sessionState.phase) {\r\n                            SessionPhase.PRACTICING -> KaraokePhase.SINGING\r\n                            SessionPhase.BETWEEN_SEGMENTS -> KaraokePhase.BETWEEN_SEGMENTS\r\n                            SessionPhase.COMPLETED -> KaraokePhase.FINISHED\r\n                            else -> it.phase\r\n                        },\r\n                        currentSegment = sessionState.activeSegmentIndex ?: it.currentSegment,\r\n                        segmentProgress = sessionState.segmentProgress,\r\n                        currentPitch = sessionState.currentPitch\r\n                    )\r\n                }\r\n            }\r\n        }\r\n\r\n        _state.update { it.copy(phase = KaraokePhase.READY) }\r\n    }\r\n\r\n    fun startSinging() {\r\n        session?.startPracticingSegment(0)\r\n    }\r\n\r\n    fun skipToSegment(index: Int) {\r\n        session?.startPracticingSegment(index)\r\n    }\r\n\r\n    fun pause() {\r\n        session?.pause()\r\n    }\r\n\r\n    fun resume() {\r\n        session?.resume()\r\n    }\r\n\r\n    private fun handleSongEnd() {\r\n        val result = session?.finishSession()\r\n        _state.update {\r\n            it.copy(\r\n                phase = KaraokePhase.FINISHED,\r\n                overallScore = result?.overallScore ?: 0f\r\n            )\r\n        }\r\n    }\r\n\r\n    fun cleanup() {\r\n        session?.closeSession()\r\n        player?.release()\r\n        recorder?.release()\r\n    }\r\n}\n"})}),"\n",(0,t.jsx)(r.h3,{id:"ui-compose",children:"UI (Compose)"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-kotlin",children:'@Composable\r\nfun KaraokeScreen(viewModel: KaraokeViewModel) {\r\n    val state by viewModel.state.collectAsState()\r\n    val pitchContour by viewModel.livePitch.collectAsState()\r\n\r\n    Column(modifier = Modifier.fillMaxSize()) {\r\n        // Pitch visualization\r\n        PitchVisualization(\r\n            contour = pitchContour,\r\n            modifier = Modifier.weight(1f)\r\n        )\r\n\r\n        // Current segment info\r\n        SegmentProgress(\r\n            segment = state.currentSegment,\r\n            progress = state.segmentProgress\r\n        )\r\n\r\n        // Score display\r\n        state.currentScore?.let { score ->\r\n            ScoreDisplay(score = score)\r\n        }\r\n\r\n        // Controls\r\n        Row(\r\n            modifier = Modifier.fillMaxWidth(),\r\n            horizontalArrangement = Arrangement.SpaceEvenly\r\n        ) {\r\n            // Pitch control\r\n            Slider(\r\n                value = viewModel.pitchShift,\r\n                onValueChange = { viewModel.pitchShift = it },\r\n                valueRange = -6f..6f\r\n            )\r\n\r\n            // Tempo control\r\n            Slider(\r\n                value = viewModel.tempoFactor,\r\n                onValueChange = { viewModel.tempoFactor = it },\r\n                valueRange = 0.5f..1.5f\r\n            )\r\n        }\r\n\r\n        // Action button\r\n        when (state.phase) {\r\n            KaraokePhase.READY -> {\r\n                Button(onClick = { viewModel.startSinging() }) {\r\n                    Text("Start")\r\n                }\r\n            }\r\n            KaraokePhase.SINGING -> {\r\n                Button(onClick = { viewModel.pause() }) {\r\n                    Text("Pause")\r\n                }\r\n            }\r\n            KaraokePhase.FINISHED -> {\r\n                FinalScoreDisplay(score = state.overallScore)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n@Composable\r\nfun PitchVisualization(contour: PitchContour, modifier: Modifier = Modifier) {\r\n    Canvas(modifier = modifier) {\r\n        val width = size.width\r\n        val height = size.height\r\n\r\n        contour.samples.forEachIndexed { index, point ->\r\n            if (point.pitch > 0) {\r\n                val x = (index.toFloat() / contour.samples.size) * width\r\n                val y = height - (pitchToY(point.pitch, height))\r\n                drawCircle(\r\n                    color = Color.Blue,\r\n                    radius = 4f,\r\n                    center = Offset(x, y)\r\n                )\r\n            }\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(r.h3,{id:"swift-swiftui",children:"Swift (SwiftUI)"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-swift",children:'struct KaraokeView: View {\r\n    @StateObject private var viewModel = KaraokeViewModel()\r\n\r\n    var body: some View {\r\n        VStack {\r\n            // Pitch visualization\r\n            PitchVisualizationView(contour: viewModel.livePitch)\r\n                .frame(height: 200)\r\n\r\n            // Progress\r\n            ProgressView(value: viewModel.state.segmentProgress)\r\n\r\n            // Score\r\n            if let score = viewModel.state.currentScore {\r\n                Text("Score: \\(Int(score * 100))%")\r\n                    .font(.title)\r\n            }\r\n\r\n            // Controls\r\n            HStack {\r\n                VStack {\r\n                    Text("Key: \\(Int(viewModel.pitchShift))")\r\n                    Slider(value: $viewModel.pitchShift, in: -6...6, step: 1)\r\n                }\r\n\r\n                VStack {\r\n                    Text("Tempo: \\(Int(viewModel.tempoFactor * 100))%")\r\n                    Slider(value: $viewModel.tempoFactor, in: 0.5...1.5)\r\n                }\r\n            }\r\n            .padding()\r\n\r\n            // Start button\r\n            Button(viewModel.isPlaying ? "Pause" : "Start") {\r\n                if viewModel.isPlaying {\r\n                    viewModel.pause()\r\n                } else {\r\n                    viewModel.startSinging()\r\n                }\r\n            }\r\n            .buttonStyle(.borderedProminent)\r\n        }\r\n        .padding()\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"key-features",children:"Key Features"}),"\n",(0,t.jsx)(r.h3,{id:"echo-cancellation",children:"Echo Cancellation"}),"\n",(0,t.jsx)(r.p,{children:"Removes the backing track from the vocal recording:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-kotlin",children:"val recorder = SonixRecorder.createTemporary(\r\n    SonixRecorderConfig.Builder()\r\n        .echoCancellation(true)\r\n        .playbackSyncProvider(player.asPlaybackInfoProvider)\r\n        .build()\r\n)\n"})}),"\n",(0,t.jsx)(r.h3,{id:"key-transposition",children:"Key Transposition"}),"\n",(0,t.jsx)(r.p,{children:"Let users sing in their comfortable key:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-kotlin",children:"player.pitch = userKeyOffset  // -6 to +6 semitones\r\nsession.setStudentKeyHz(referenceKeyHz * semitoneMultiplier(userKeyOffset))\n"})}),"\n",(0,t.jsx)(r.h3,{id:"practice-mode",children:"Practice Mode"}),"\n",(0,t.jsx)(r.p,{children:"Slow down for difficult sections:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-kotlin",children:"player.tempo = 0.75f  // 75% speed\n"})}),"\n",(0,t.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"../guides/live-evaluation",children:"Live Evaluation Guide"})," - Deeper into scoring"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"../concepts/audio-effects",children:"Audio Effects Concepts"})," - Add reverb to vocals"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"https://github.com/musicmuni/voxatrace/tree/main/public/demo-apps",children:"Demo App"})," - Full source code"]}),"\n"]})]})}function u(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,r,n){n.d(r,{R:()=>o,x:()=>l});var a=n(6540);const t={},i=a.createContext(t);function o(e){const r=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),a.createElement(i.Provider,{value:r},e.children)}}}]);